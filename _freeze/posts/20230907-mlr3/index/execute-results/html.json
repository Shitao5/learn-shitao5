{
  "hash": "5f57e9ca3bb1dbde1a978955233a95de",
  "result": {
    "markdown": "---\ntitle: \"mlr3verse æŠ€æœ¯æ‰‹å†Œ\"\ndate: \"2023-09-07\"\ndate-modified: \"2023-09-12\"\nimage: \"cover.jpg\"\ncategories: \n  - Machine Learning\n  - R\n  - mlr3\n---\n\n\n::: {.callout-note title='Progress'}\nLearning Progress: Completed.ğŸŠ\n:::\n\n::: {.callout-tip title=\"Learning Source\"}\n- å¼ æ•¬ä¿¡è€å¸ˆ QQ ç¾¤ï¼ˆ222427909ï¼‰æ–‡ä»¶\n- <https://github.com/zhjx19/RConf15/tree/main>\n:::\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(mlr3verse)\n```\n:::\n\n\n# åŸºç¡€çŸ¥è¯†\n\n## ä»»åŠ¡ï¼šå°è£…æ•°æ®\n\nä»»åŠ¡æ˜¯è¡¨æ ¼æ•°æ®çš„å°è£…ï¼Œè‡ªå˜é‡ä¸ºç‰¹å¾ï¼Œå› å˜é‡ä¸ºç›®æ ‡æˆ–ç»“æœå˜é‡ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntsks() # æŸ¥çœ‹æ‰€æœ‰è‡ªå¸¦ä»»åŠ¡\n#> <DictionaryTask> with 21 stored values\n#> Keys: ames_housing, bike_sharing, boston_housing, breast_cancer,\n#>   german_credit, ilpd, iris, kc_housing, moneyball, mtcars, optdigits,\n#>   penguins, penguins_simple, pima, ruspini, sonar, spam, titanic,\n#>   usarrests, wine, zoo\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# åˆ›å»ºä»»åŠ¡\ndat = tsk(\"german_credit\")$data() # æå–æ•°æ®\ntask = as_task_classif(dat, target = \"credit_risk\")\ntask\n#> <TaskClassif:dat> (1000 x 21)\n#> * Target: credit_risk\n#> * Properties: twoclass\n#> * Features (20):\n#>   - fct (14): credit_history, employment_duration, foreign_worker,\n#>     housing, job, other_debtors, other_installment_plans,\n#>     people_liable, personal_status_sex, property, purpose, savings,\n#>     status, telephone\n#>   - int (3): age, amount, duration\n#>   - ord (3): installment_rate, number_credits, present_residence\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# é€‰æ‹©ç‰¹å¾\ntask$select(cols = setdiff(task$feature_names, \"telephone\"))\ntask\n#> <TaskClassif:dat> (1000 x 20)\n#> * Target: credit_risk\n#> * Properties: twoclass\n#> * Features (19):\n#>   - fct (13): credit_history, employment_duration, foreign_worker,\n#>     housing, job, other_debtors, other_installment_plans,\n#>     people_liable, personal_status_sex, property, purpose, savings,\n#>     status\n#>   - int (3): age, amount, duration\n#>   - ord (3): installment_rate, number_credits, present_residence\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# åˆ’åˆ†è®­ç»ƒé›†ã€æµ‹è¯•é›†\nset.seed(1)\nsplit = partition(task, ratio = .7)\n```\n:::\n\n\n`stratify = TRUE` é»˜è®¤æŒ‰ç›®æ ‡å˜é‡åˆ†å±‚ï¼Œå¾—åˆ°è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„ç´¢å¼•ï¼ˆè¡Œå·ï¼‰ã€‚\n\n## å­¦ä¹ å™¨ï¼šå°è£…ç®—æ³•\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlrns()  # æŸ¥çœ‹æ‰€æœ‰è‡ªå¸¦å­¦ä¹ å™¨åå­—\n#> <DictionaryLearner> with 46 stored values\n#> Keys: classif.cv_glmnet, classif.debug, classif.featureless,\n#>   classif.glmnet, classif.kknn, classif.lda, classif.log_reg,\n#>   classif.multinom, classif.naive_bayes, classif.nnet, classif.qda,\n#>   classif.ranger, classif.rpart, classif.svm, classif.xgboost,\n#>   clust.agnes, clust.ap, clust.cmeans, clust.cobweb, clust.dbscan,\n#>   clust.diana, clust.em, clust.fanny, clust.featureless, clust.ff,\n#>   clust.hclust, clust.kkmeans, clust.kmeans, clust.MBatchKMeans,\n#>   clust.mclust, clust.meanshift, clust.pam, clust.SimpleKMeans,\n#>   clust.xmeans, regr.cv_glmnet, regr.debug, regr.featureless,\n#>   regr.glmnet, regr.kknn, regr.km, regr.lm, regr.nnet, regr.ranger,\n#>   regr.rpart, regr.svm, regr.xgboost\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# é€‰æ‹©éšæœºæ£®æ—åˆ†ç±»å­¦ä¹ å™¨\nlearner = lrn(\"classif.ranger\", num.trees = 100, predict_type = \"prob\")\nlearner\n#> <LearnerClassifRanger:classif.ranger>\n#> * Model: -\n#> * Parameters: num.threads=1, num.trees=100\n#> * Packages: mlr3, mlr3learners, ranger\n#> * Predict Types:  response, [prob]\n#> * Feature Types: logical, integer, numeric, character, factor, ordered\n#> * Properties: hotstart_backward, importance, multiclass, oob_error,\n#>   twoclass, weights\n```\n:::\n\n\nå­¦ä¹ å™¨ `$model` å±æ€§ä¸º `NULL`ï¼Œç”¨ `$train()` æ–¹æ³•åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œæ¨¡å‹ç»“æœå­˜å…¥ `$model`ï¼Œå†ç”¨ `predict()` æ–¹æ³•åœ¨æµ‹è¯•é›†ä¸Šåšé¢„æµ‹ï¼Œå¾—åˆ°ç»“æœæ˜¯ `Prediction` å¯¹è±¡ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlearner$train(task, row_ids = split$train)\nlearner$model\n#> Ranger result\n#> \n#> Call:\n#>  ranger::ranger(dependent.variable.name = task$target_names, data = task$data(),      probability = self$predict_type == \"prob\", case.weights = task$weights$weight,      num.threads = 1L, num.trees = 100L) \n#> \n#> Type:                             Probability estimation \n#> Number of trees:                  100 \n#> Sample size:                      700 \n#> Number of independent variables:  19 \n#> Mtry:                             4 \n#> Target node size:                 10 \n#> Variable importance mode:         none \n#> Splitrule:                        gini \n#> OOB prediction error (Brier s.):  0.1615879\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprediction = learner$predict(task, row_ids = split$test)\nprediction\n```\n:::\n\n\n## æ€§èƒ½è¯„ä¼°\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmsrs() # æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„æ€§èƒ½åº¦é‡æŒ‡æ ‡\n#> <DictionaryMeasure> with 66 stored values\n#> Keys: aic, bic, classif.acc, classif.auc, classif.bacc, classif.bbrier,\n#>   classif.ce, classif.costs, classif.dor, classif.fbeta, classif.fdr,\n#>   classif.fn, classif.fnr, classif.fomr, classif.fp, classif.fpr,\n#>   classif.logloss, classif.mauc_au1p, classif.mauc_au1u,\n#>   classif.mauc_aunp, classif.mauc_aunu, classif.mbrier, classif.mcc,\n#>   classif.npv, classif.ppv, classif.prauc, classif.precision,\n#>   classif.recall, classif.sensitivity, classif.specificity, classif.tn,\n#>   classif.tnr, classif.tp, classif.tpr, clust.ch, clust.dunn,\n#>   clust.silhouette, clust.wss, debug_classif, oob_error, regr.bias,\n#>   regr.ktau, regr.mae, regr.mape, regr.maxae, regr.medae, regr.medse,\n#>   regr.mse, regr.msle, regr.pbias, regr.rae, regr.rmse, regr.rmsle,\n#>   regr.rrse, regr.rse, regr.rsq, regr.sae, regr.smape, regr.srho,\n#>   regr.sse, selected_features, sim.jaccard, sim.phi, time_both,\n#>   time_predict, time_train\n```\n:::\n\n\nç”¨é¢„æµ‹å¯¹è±¡çš„ `$score()` æ–¹æ³•ï¼Œè®¡ç®—è¯¥åº¦é‡æŒ‡æ ‡çš„å¾—åˆ†ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprediction$score(msr(\"classif.acc\"))  # å‡†ç¡®ç‡\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# ç»˜åˆ¶ ROC æ›²çº¿\nlibrary(precrec)\nautoplot(prediction, type = \"roc\")\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprediction$score(msr(\"classif.auc\"))  # auc é¢ç§¯\n```\n:::\n\n\n## é‡æŠ½æ ·\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrsmps()  # æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„é‡æŠ½æ ·æ–¹æ³•\n#> <DictionaryResampling> with 9 stored values\n#> Keys: bootstrap, custom, custom_cv, cv, holdout, insample, loo,\n#>   repeated_cv, subsampling\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncv10 = rsmp(\"cv\", folds = 10)  # 10 æŠ˜äº¤å‰éªŒè¯\n```\n:::\n\n\n### å®ä¾‹åŒ–é‡æŠ½æ ·å¯¹è±¡\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncv10$instantiate(task)  # å®ä¾‹åŒ–\ncv10$iters  # æ•°æ®å‰¯æœ¬æ•°\n#> [1] 10\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncv10$train_set(1)  # ç¬¬ 1 ä¸ªæ•°æ®å‰¯æœ¬çš„è®­ç»ƒé›†ç´¢å¼•\ncv10$test_set(1)   # ç¬¬ 1 ä¸ªæ•°æ®å‰¯æœ¬çš„æµ‹è¯•é›†ç´¢å¼•\n```\n:::\n\n\n### ä½¿ç”¨é‡æŠ½æ ·\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr =  resample(task, learner, cv10, store_models = TRUE)\n#> INFO  [15:10:52.117] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 1/10)\n#> INFO  [15:10:52.368] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 2/10)\n#> INFO  [15:10:52.429] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 3/10)\n#> INFO  [15:10:52.485] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 4/10)\n#> INFO  [15:10:52.543] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 5/10)\n#> INFO  [15:10:52.603] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 6/10)\n#> INFO  [15:10:52.659] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 7/10)\n#> INFO  [15:10:52.717] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 8/10)\n#> INFO  [15:10:52.774] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 9/10)\n#> INFO  [15:10:52.836] [mlr3] Applying learner 'classif.ranger' on task 'dat' (iter 10/10)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr$aggregate(msr(\"classif.acc\"))  # æ‰€æœ‰é‡æŠ½æ ·çš„å¹³å‡å‡†ç¡®ç‡\n#> classif.acc \n#>       0.753\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr$score(msr(\"classif.acc\"))  # å„ä¸ªé‡æŠ½æ ·çš„å¹³å‡å‡†ç¡®ç‡\n#>     task_id     learner_id resampling_id iteration classif.acc\n#>  1:     dat classif.ranger            cv         1        0.77\n#>  2:     dat classif.ranger            cv         2        0.84\n#>  3:     dat classif.ranger            cv         3        0.70\n#>  4:     dat classif.ranger            cv         4        0.77\n#>  5:     dat classif.ranger            cv         5        0.76\n#>  6:     dat classif.ranger            cv         6        0.75\n#>  7:     dat classif.ranger            cv         7        0.71\n#>  8:     dat classif.ranger            cv         8        0.83\n#>  9:     dat classif.ranger            cv         9        0.66\n#> 10:     dat classif.ranger            cv        10        0.74\n#> Hidden columns: task, learner, resampling, prediction\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# æŸ¥çœ‹ç¬¬ 1 ä¸ªæ•°æ®å‰¯æœ¬ï¼ˆç¬¬ 1 æŠ˜ï¼‰ä¸Šçš„ç»“æœ\nrr$resampling$train_set(1)  # ç¬¬ 1 æŠ˜çš„è®­ç»ƒé›†ç´¢å¼•\nrr$learners[[1]]$model      # ç¬¬ 1 æŠ˜å­¦ä¹ å™¨çš„æ‹Ÿåˆæ¨¡å‹\nrr$predictions()[[1]]       # ç¬¬ 1 æŠ˜çš„é¢„æµ‹ç»“æœ\n```\n:::\n\n\n## åŸºå‡†æµ‹è¯•\n\nåŸºå‡†æµ‹è¯•ï¼ˆbenchmarkï¼‰ç”¨æ¥æ¯”è¾ƒä¸åŒå­¦ä¹ å™¨ï¼ˆç®—æ³•ï¼‰ã€åœ¨å¤šä¸ªä»»åŠ¡ï¼ˆæ•°æ®ï¼‰å’Œ/æˆ–ä¸åŒé‡æŠ½æ ·ç­–ç•¥ï¼ˆå¤šä¸ªæ•°æ®å‰¯æœ¬ï¼‰ä¸Šçš„å¹³å‡æ€§èƒ½è¡¨ç°ã€‚\n\nåŸºå‡†æµ‹è¯•æ—¶æœ‰ä¸ªå…³é”®é—®é¢˜ï¼šæµ‹è¯•çš„å…¬å¹³æ€§ã€‚å³æ¯ä¸ªç®—æ³•çš„æ¯æ¬¡æµ‹è¯•å¿…é¡»åœ¨ç›¸åŒçš„é‡æŠ½æ ·è®­ç»ƒé›†æ‹Ÿåˆæ¨¡å‹ï¼Œåœ¨ç›¸åŒçš„é‡æŠ½æ ·æµ‹è¯•é›†è¯„ä¼°æ€§èƒ½ã€‚è¿™äº›äº‹æƒ… `beachmark()` ä¼šè‡ªåŠ¨åšå¥½ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntasks = tsk(\"sonar\")  # å¯ä»¥å¤šä»»åŠ¡\nlearners = lrns(c(\"classif.rpart\", \"classif.kknn\", \"classif.ranger\", \"classif.svm\"),\n                predict_type = \"prob\")\ndesign = benchmark_grid(tasks, learners, rsmps(\"cv\", folds = 5))\ndesign\n#>     task        learner resampling\n#> 1: sonar  classif.rpart         cv\n#> 2: sonar   classif.kknn         cv\n#> 3: sonar classif.ranger         cv\n#> 4: sonar    classif.svm         cv\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbmr = benchmark(design)  # æ‰§è¡ŒåŸºå‡†æµ‹è¯•\nbmr$aggregate(list(msr(\"classif.acc\"), msr(\"classif.auc\")))  # æ±‡æ€»åŸºå‡†æµ‹è¯•ç»“æœ\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å¯è§†åŒ–ï¼šå¯¹æ¯”æ€§èƒ½\nautoplot(bmr, type = \"roc\")  # ROC æ›²çº¿\nautoplot(bmr, measure = msr(\"classif.auc\"))  # AUC ç®±çº¿å›¾\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-25-1.png){fig-align='center' width=70%}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-25-2.png){fig-align='center' width=70%}\n:::\n:::\n\n\n## å¯è§†åŒ–\n\nmlr3viz åŒ…å®šä¹‰äº† `autoplot()` å‡½æ•°æ¥ç”¨ ggplot2 ç»˜å›¾ã€‚é€šå¸¸ä¸€ä¸ªå¯¹è±¡æœ‰ä¸æ­¢ä¸€ç§ç±»å‹çš„å›¾ï¼Œå¯ä»¥é€šè¿‡ `type` å‚æ•°æ¥æ”¹å˜ç»˜å›¾ã€‚å›¾å½¢ä½¿ç”¨ viridis çš„è°ƒè‰²æ¿ï¼Œå¤–è§‚ç”± theme å‚æ•°æ§åˆ¶ï¼Œé»˜è®¤æ˜¯ minimal ä¸»é¢˜ã€‚\n\n### å¯è§†åŒ–ä»»åŠ¡\n\n#### åˆ†ç±»ä»»åŠ¡\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"penguins\")\ntask$select(c(\"body_mass\", \"bill_length\"))\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nautoplot(task, type = \"target\")  # \"target\" å›¾ï¼šæ¡å½¢å›¾å±•ç¤ºç›®æ ‡å˜é‡çš„å„ç±»åˆ«é¢‘æ•°\nautoplot(task, type = \"duo\")     # \"duo\" å›¾ï¼šç®±çº¿å›¾å±•ç¤ºå¤šä¸ªç‰¹å¾çš„åˆ†å¸ƒ\nautoplot(task, type = \"pairs\")   # \"pairs\" å›¾ï¼šå±•ç¤ºå¤šä¸ªç‰¹å¾çš„æˆå¯¹æ¯”è¾ƒ\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-27-1.png){fig-align='center' width=70%}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-27-2.png){fig-align='center' width=70%}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-27-3.png){fig-align='center' width=70%}\n:::\n:::\n\n\n#### å›å½’ä»»åŠ¡\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"mtcars\")\ntask$select(c(\"am\", \"carb\"))\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nautoplot(task, type = \"target\")  # \"target\" å›¾ï¼šç®±çº¿å›¾å±•ç¤ºç›®æ ‡å˜é‡çš„åˆ†å¸ƒ\nautoplot(task, type = \"pairs\")   # \"pairs\" å›¾ï¼šå±•ç¤ºå¤šä¸ªç‰¹å¾ä¸ç›®æ ‡å˜é‡çš„æˆå¯¹æ¯”è¾ƒ\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-29-1.png){fig-align='center' width=70%}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-29-2.png){fig-align='center' width=70%}\n:::\n:::\n\n\n### å¯è§†åŒ–å­¦ä¹ å™¨\n\n#### glmnet å›å½’å­¦ä¹ å™¨\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"mtcars\")\nlearner = lrn(\"regr.glmnet\")\nlearner$train(task)\nautoplot(learner)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-30-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n#### å†³ç­–æ ‘å­¦ä¹ å™¨\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# åˆ†ç±»æ ‘\ntask = tsk(\"penguins\")\nlearner = lrn(\"classif.rpart\", keep_model = TRUE)\nlearner$train(task)\nautoplot(learner)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-31-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å›å½’æ ‘\ntask = tsk(\"mtcars\")\nlearner = lrn(\"regr.rpart\", keep_model = TRUE)\nlearner$train(task)\nautoplot(learner)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-32-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n#### å±‚æ¬¡èšç±»å­¦ä¹ å™¨\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å±‚æ¬¡èšç±»æ ‘\ntask = tsk(\"usarrests\")\nlearner = lrn(\"clust.hclust\")\nlearner$train(task)\nautoplot(learner, type = \"dend\", task = task)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-33-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# ç¢çŸ³å›¾\nautoplot(learner, type = \"scree\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-34-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n### å¯è§†åŒ–é¢„æµ‹å¯¹è±¡\n\n#### åˆ†ç±»é¢„æµ‹å¯¹è±¡\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"stacked\" å›¾ï¼šå †å æ¡å½¢å›¾å±•ç¤ºé¢„æµ‹ç±»åˆ«å’ŒçœŸå®ç±»åˆ«é¢‘æ•°å¯¹æ¯”\ntask = tsk(\"spam\")\nlearner = lrn(\"classif.rpart\", predict_type = \"prob\")\npred = learner$train(task)$predict(task)\nautoplot(pred, type = \"stacked\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-35-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# ROC æ›²çº¿ï¼šå±•ç¤ºä¸åŒé˜ˆå€¼ä¸‹çš„çœŸé˜³ç‡ä¸å‡é˜³ç‡\nautoplot(pred, type = \"roc\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-36-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# PR æ›²çº¿ï¼šå±•ç¤ºä¸åŒé˜ˆå€¼ä¸‹çš„æŸ¥å‡†ç‡ä¸å¬å›ç‡\nautoplot(pred, type = \"prc\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-37-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# â€œthresholdâ€ å›¾ï¼šå±•ç¤ºäºŒå…ƒåˆ†ç±»åœ¨ä¸åŒé˜ˆå€¼ä¸‹çš„æ€§èƒ½\nautoplot(pred, type = \"threshold\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-38-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n#### å›å½’é¢„æµ‹å¯¹è±¡\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"xy\" å›¾ï¼šæ•£ç‚¹å›¾å±•ç¤ºå›å½’é¢„æµ‹çš„çœŸå®å€¼ä¸é¢„æµ‹å€¼\ntask = tsk(\"boston_housing\")\nlearner = lrn(\"regr.rpart\")\npred = learner$train(task)$predict(task)\nautoplot(pred, type = \"xy\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-39-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"residual\" å›¾ï¼šç»˜åˆ¶å“åº”çš„æ®‹å·®å›¾\nautoplot(pred, type = \"residual\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-40-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"histogram\" å›¾ï¼šæ®‹å·®ç›´æ–¹å›¾å±•ç¤ºæ®‹å·®çš„åˆ†å¸ƒ\nautoplot(pred, type = \"histogram\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-41-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n#### èšç±»é¢„æµ‹å¯¹è±¡\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"scatter\" å›¾ï¼šç»˜åˆ¶æŒ‰èšç±»é¢„æµ‹ç»“æœç€è‰²çš„æ•£ç‚¹å›¾\ntask = tsk(\"usarrests\")\nlearner = lrn(\"clust.kmeans\", centers = 3)\npred = learner$train(task)$predict(task)\nautoplot(pred, task, type = \"scatter\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-42-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"sil\" å›¾ï¼šå±•ç¤ºèšç±»çš„silhouette å®½åº¦ï¼Œè™šçº¿æ˜¯å¹³å‡silhouette å®½åº¦\nautoplot(pred, task, type = \"sil\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-43-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"pca\" å›¾ï¼šå±•ç¤ºæ•°æ®çš„å‰ä¸¤ä¸ªä¸»æˆåˆ†ï¼Œä¸åŒèšç±»ç”¨é¢œè‰²åŒºåˆ†\nautoplot(pred, task, type = \"pca\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-44-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n### å¯è§†åŒ–é‡æŠ½æ ·ç»“æœ\n\n#### åˆ†ç±»é‡æŠ½æ ·ç»“æœ\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"boxplot\"/\"histogram\" å›¾ï¼šç®±çº¿å›¾å±•ç¤ºæ€§èƒ½åº¦é‡çš„åˆ†å¸ƒ\ntask = tsk(\"sonar\")\nlearner = lrn(\"classif.rpart\", predict_type = \"prob\")\nresampling = rsmp(\"cv\")\nrr = resample(task, learner, resampling)\n#> INFO  [15:11:07.498] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 1/10)\n#> INFO  [15:11:07.535] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 2/10)\n#> INFO  [15:11:07.565] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 3/10)\n#> INFO  [15:11:07.594] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 4/10)\n#> INFO  [15:11:07.623] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 5/10)\n#> INFO  [15:11:07.657] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 6/10)\n#> INFO  [15:11:07.688] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 7/10)\n#> INFO  [15:11:07.721] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 8/10)\n#> INFO  [15:11:07.754] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 9/10)\n#> INFO  [15:11:07.785] [mlr3] Applying learner 'classif.rpart' on task 'sonar' (iter 10/10)\nautoplot(rr, type = \"boxplot\")\nautoplot(rr, type = \"histogram\")\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-45-1.png){fig-align='center' width=70%}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-45-2.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# ROC æ›²çº¿ï¼šå±•ç¤ºä¸åŒé˜ˆå€¼ä¸‹çš„çœŸé˜³ç‡ä¸å‡é˜³ç‡\nautoplot(rr, type = \"roc\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-46-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# PR æ›²çº¿ï¼šå±•ç¤ºä¸åŒé˜ˆå€¼ä¸‹çš„æŸ¥å‡†ç‡ä¸å¬å›ç‡\nautoplot(rr, type = \"prc\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-47-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"prediction\" å›¾ï¼šå±•ç¤ºä¸¤ä¸ªç‰¹å¾è¡¨ç¤ºçš„æµ‹è¯•é›†æ ·æœ¬ç‚¹å’Œä»¥èƒŒæ™¯è‰²åŒºåˆ†çš„é¢„æµ‹ç±»åˆ«\ntask = tsk(\"pima\")\ntask$filter(seq(100))\ntask$select(c(\"age\", \"glucose\"))\nlearner = lrn(\"classif.rpart\")\nresampling = rsmp(\"cv\", folds = 3)\nrr = resample(task, learner, resampling, store_models = TRUE)\n#> INFO  [15:11:09.101] [mlr3] Applying learner 'classif.rpart' on task 'pima' (iter 1/3)\n#> INFO  [15:11:09.124] [mlr3] Applying learner 'classif.rpart' on task 'pima' (iter 2/3)\n#> INFO  [15:11:09.158] [mlr3] Applying learner 'classif.rpart' on task 'pima' (iter 3/3)\nautoplot(rr, type = \"prediction\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-48-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è‹¥å°†å­¦ä¹ å™¨çš„é¢„æµ‹ç±»å‹æ”¹ä¸º\"prob\"ï¼Œåˆ™ç”¨é¢œè‰²æ·±æµ…å±•ç¤ºæ¦‚ç‡å€¼\nlearner = lrn(\"classif.rpart\", predict_type = \"prob\")\nresampling = rsmp(\"cv\", folds = 3)\nrr = resample(task, learner, resampling, store_models = TRUE)\n#> INFO  [15:11:10.010] [mlr3] Applying learner 'classif.rpart' on task 'pima' (iter 1/3)\n#> INFO  [15:11:10.034] [mlr3] Applying learner 'classif.rpart' on task 'pima' (iter 2/3)\n#> INFO  [15:11:10.058] [mlr3] Applying learner 'classif.rpart' on task 'pima' (iter 3/3)\nautoplot(rr, type = \"prediction\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-49-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# ä¸Šé¢æ˜¯åªç»˜åˆ¶æµ‹è¯•é›†ï¼Œä¹Ÿå¯ä»¥åŠ å…¥è®­ç»ƒé›†\nlearner = lrn(\"classif.rpart\", predict_type = \"prob\",\n              predict_sets = c(\"train\", \"test\"))\nresampling = rsmp(\"cv\", folds = 3)\nrr = resample(task, learner, resampling, store_models = TRUE)\n#> INFO  [15:11:11.101] [mlr3] Applying learner 'classif.rpart' on task 'pima' (iter 1/3)\n#> INFO  [15:11:11.132] [mlr3] Applying learner 'classif.rpart' on task 'pima' (iter 2/3)\n#> INFO  [15:11:11.174] [mlr3] Applying learner 'classif.rpart' on task 'pima' (iter 3/3)\nautoplot(rr, type = \"prediction\",\n         predict_sets = c(\"train\", \"test\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-50-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"prediction\" å›¾ä¹Ÿå¯ä»¥ç»˜åˆ¶åˆ†ç±»ç‰¹å¾\ntask = tsk(\"german_credit\")\ntask$filter(seq(100))\ntask$select(c(\"housing\", \"employment_duration\"))\nlearner = lrn(\"classif.rpart\")\nresampling = rsmp(\"cv\", folds = 3)\nrr = resample(task, learner, resampling, store_models = TRUE)\n#> INFO  [15:11:12.175] [mlr3] Applying learner 'classif.rpart' on task 'german_credit' (iter 1/3)\n#> INFO  [15:11:12.198] [mlr3] Applying learner 'classif.rpart' on task 'german_credit' (iter 2/3)\n#> INFO  [15:11:12.221] [mlr3] Applying learner 'classif.rpart' on task 'german_credit' (iter 3/3)\nautoplot(rr, type = \"prediction\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-51-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n#### å›å½’é‡æŠ½æ ·ç»“æœ\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"prediction\" å›¾ï¼šç»˜åˆ¶ä¸€ä¸ªç‰¹å¾ä¸å“åº”çš„æ•£ç‚¹å›¾ï¼Œæ•£ç‚¹è¡¨ç¤ºæµ‹è¯•é›†ä¸­çš„è§‚æµ‹\ntask = tsk(\"boston_housing\")\ntask$select(\"age\")\ntask$filter(seq(100))\nlearner = lrn(\"regr.rpart\")\nresampling = rsmp(\"cv\", folds = 3)\nrr = resample(task, learner, resampling, store_models = TRUE)\n#> INFO  [15:11:13.043] [mlr3] Applying learner 'regr.rpart' on task 'boston_housing' (iter 1/3)\n#> INFO  [15:11:13.064] [mlr3] Applying learner 'regr.rpart' on task 'boston_housing' (iter 2/3)\n#> INFO  [15:11:13.082] [mlr3] Applying learner 'regr.rpart' on task 'boston_housing' (iter 3/3)\nautoplot(rr, type = \"prediction\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-52-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è‹¥å°†å­¦ä¹ å™¨çš„é¢„æµ‹ç±»å‹æ”¹ä¸º\"se\"ï¼Œè¿˜å¯ä»¥åŠ ä¸Šç½®ä¿¡å¸¦\nlearner = lrn(\"regr.lm\", predict_type = \"se\")\nresampling = rsmp(\"cv\", folds = 3)\nrr = resample(task, learner, resampling, store_models = TRUE)\n#> INFO  [15:11:13.692] [mlr3] Applying learner 'regr.lm' on task 'boston_housing' (iter 1/3)\n#> INFO  [15:11:13.711] [mlr3] Applying learner 'regr.lm' on task 'boston_housing' (iter 2/3)\n#> INFO  [15:11:13.729] [mlr3] Applying learner 'regr.lm' on task 'boston_housing' (iter 3/3)\nautoplot(rr, type = \"prediction\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-53-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# ä¸Šé¢æ˜¯åªç»˜åˆ¶æµ‹è¯•é›†ï¼Œä¹Ÿå¯ä»¥åŠ å…¥è®­ç»ƒé›†\ntask$select(\"age\")\nlearner = lrn(\"regr.lm\", predict_type = \"se\",\n              predict_sets = c(\"train\", \"test\"))\nresampling = rsmp(\"cv\", folds = 3)\nrr = resample(task, learner, resampling, store_models = TRUE)\n#> INFO  [15:11:14.399] [mlr3] Applying learner 'regr.lm' on task 'boston_housing' (iter 1/3)\n#> INFO  [15:11:14.419] [mlr3] Applying learner 'regr.lm' on task 'boston_housing' (iter 2/3)\n#> INFO  [15:11:14.441] [mlr3] Applying learner 'regr.lm' on task 'boston_housing' (iter 3/3)\nautoplot(rr, type = \"prediction\",\n         predict_sets = c(\"train\", \"test\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-54-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è¿˜å¯ä»¥å°†é¢„æµ‹é¢æ·»åŠ åˆ°èƒŒæ™¯\ntask = tsk(\"boston_housing\")\ntask$select(c(\"age\", \"rm\"))\ntask$filter(seq(100))\nlearner = lrn(\"regr.rpart\")\nresampling = rsmp(\"cv\", folds = 3)\nrr = resample(task, learner, resampling, store_models = TRUE)\n#> INFO  [15:11:15.202] [mlr3] Applying learner 'regr.rpart' on task 'boston_housing' (iter 1/3)\n#> INFO  [15:11:15.221] [mlr3] Applying learner 'regr.rpart' on task 'boston_housing' (iter 2/3)\n#> INFO  [15:11:15.239] [mlr3] Applying learner 'regr.rpart' on task 'boston_housing' (iter 3/3)\nautoplot(rr, type = \"prediction\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-55-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n### å¯è§†åŒ–åŸºå‡†æµ‹è¯•ç»“æœ\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"boxplot\" å›¾ï¼šç®±çº¿å›¾å±•ç¤ºäº†å¤šä¸ªä»»åŠ¡çš„åŸºå‡†æµ‹è¯•çš„æ€§èƒ½åˆ†å¸ƒ\ntasks = tsks(c(\"pima\", \"sonar\"))\nlearners = lrns(c(\"classif.featureless\", \"classif.rpart\", \"classif.xgboost\"),\n                predict_type = \"prob\")\nresampling = rsmps(\"cv\")\nbmr = benchmark(benchmark_grid(tasks, learners, resampling))\nautoplot(bmr, type = \"boxplot\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-56-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# ç»˜åˆ¶ä¸€ä¸ªä»»åŠ¡ä¸å¤šä¸ªå­¦ä¹ å™¨çš„åŸºå‡†æµ‹è¯•\ntask = tsk(\"pima\")\nlearners = lrns(c(\"classif.featureless\", \"classif.rpart\", \"classif.xgboost\"),\n                predict_type = \"prob\")\nresampling = rsmp(\"cv\")\nbmr = benchmark(benchmark_grid(task, learners, resampling))\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nautoplot(bmr, type = \"roc\")\nautoplot(bmr, type = \"prc\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-58-1.png){fig-align='center' width=70%}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-58-2.png){fig-align='center' width=70%}\n:::\n:::\n\n\n### å¯è§†åŒ–è°ƒå‚å®ä¾‹\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"performance\" å›¾ï¼šæ•£ç‚¹æŠ˜çº¿å›¾å±•ç¤ºéšæ‰¹æ¬¡çš„æ¨¡å‹æ€§èƒ½å˜åŒ–\ninstance = tune(\n  tuner = tnr(\"gensa\"),\n  task = tsk(\"sonar\"),\n  learner = lts(lrn(\"classif.rpart\")),\n  resampling = rsmp(\"holdout\"),\n  measures = msr(\"classif.ce\"),\n  term_evals = 100\n)\nautoplot(instance, type = \"performance\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-59-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"parameter\" å›¾ï¼šæ•£ç‚¹å›¾å±•ç¤ºæ¯ä¸ªè¶…å‚æ•°å–å€¼ä¸æ¨¡å‹æ€§èƒ½å˜åŒ–\nautoplot(instance, type = \"parameter\", cols_x = c(\"cp\", \"minsplit\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-60-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"marginal\" å›¾ï¼šå±•ç¤ºä¸åŒè¶…å‚æ•°å€¼çš„æ€§èƒ½ï¼Œé¢œè‰²è¡¨ç¤ºæ‰¹æ¬¡\nautoplot(instance, type = \"marginal\", cols_x = \"cp\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-61-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"parallel\" å›¾ï¼šå¯è§†åŒ–è¶…å‚æ•°ä¹‹é—´çš„å…³ç³»\nautoplot(instance, type = \"parallel\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-62-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"points\" å›¾ï¼šæ•£ç‚¹çƒ­åŠ›å›¾å±•ç¤ºä¸¤ä¸ªè¶…å‚æ•°çš„æ€§èƒ½å¯¹æ¯”ï¼Œç”¨é¢œè‰²æ·±æµ…è¡¨ç¤ºæ¨¡å‹æ€§èƒ½\nautoplot(instance, type = \"points\", cols_x = c(\"cp\", \"minsplit\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-63-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"pairs\" å›¾ï¼šå±•ç¤ºæ‰€æœ‰è¶…å‚æ•°æˆå¯¹å¯¹æ¯”\nautoplot(instance, type = \"pairs\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-64-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# \"surface\" å›¾ï¼šç»˜åˆ¶ä¸¤ä¸ªè¶…å‚æ•°çš„æ¨¡å‹æ€§èƒ½é¢ï¼Œè¯¥é¢æ˜¯ç”¨ä¸€ä¸ªå­¦ä¹ å™¨æ’å€¼çš„\nautoplot(instance, type = \"surface\", cols_x = c(\"cp\", \"minsplit\"),\n         learner = lrn(\"regr.ranger\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-65-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n### å¯è§†åŒ–ç‰¹å¾è¿‡æ»¤å™¨\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# æ¡å½¢å›¾å±•ç¤ºåŸºäºè¿‡æ»¤å™¨çš„ç‰¹å¾å¾—åˆ†\ntask = tsk(\"mtcars\")\nft = flt(\"correlation\")\nft$calculate(task)\nautoplot(ft, n = 5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-66-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\næ›´å¤šç»†èŠ‚åœ¨ mlr3viz åŒ…çš„ reference é¡µã€‚\n\n# å›¾å­¦ä¹ å™¨\n\nä¸€ä¸ªç®¡é“è¿ç®—ï¼ˆPipeOpï¼‰ï¼Œè¡¨ç¤ºæœºå™¨å­¦ä¹ ç®¡é“ä¸­çš„ä¸€ä¸ªè®¡ç®—æ­¥éª¤ã€‚ä¸€ç³»åˆ—çš„ PipeOps  é€šè¿‡è¾¹è¿æ¥ï¼ˆ`%>>%`ï¼‰æ„æˆå›¾ï¼ˆGraphï¼‰ï¼Œå›¾å¯ä»¥æ˜¯ç®€å•çš„çº¿æ€§å›¾ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤æ‚çš„éçº¿æ€§å›¾ã€‚\n\næ­å»ºå›¾å­¦ä¹ å™¨ï¼š\n\n- ç”¨ `po()` è·å– PipeOpï¼Œé€šè¿‡è¿æ¥ç¬¦ `%>>%` è¿æ¥ Graphs ä¸ PipeOps\n\n- é€šè¿‡ `gunion()` å°† Graphs ä¸ PipeOps å¹¶èµ·æ¥\n\n- ç”¨ `ppl(\"replicate\", graph, n)` å°† Graph æˆ– PipeOps å¤åˆ¶ n ä»½å¹¶èµ·æ¥\n\n- `Graph$plot()` ç»˜åˆ¶å›¾çš„ç»“æ„å…³ç³»\n\n- `as_learner(Graph)` å°†å›¾è½¬åŒ–ä¸ºå­¦ä¹ å™¨ï¼Œå³å¯è·Ÿæ™®é€šå­¦ä¹ å™¨ä¸€æ ·ä½¿ç”¨\n\nç®¡é“ã€å›¾å­¦ä¹ å™¨çš„ä¸»è¦ç”¨å¤„åœ¨äºï¼š\n\n- ç‰¹å¾å·¥ç¨‹ï¼šç¼ºå¤±å€¼æ’è¡¥ã€ç‰¹å¾æå–ã€ç‰¹å¾é€‰æ‹©ã€å¤„ç†ä¸å‡è¡¡æ•°æ®â€¦â€¦\n\n- é›†æˆå­¦ä¹ ï¼šè¢‹è£…æ³•ã€å †å æ³•\n\n- åˆ†æ”¯è®­ç»ƒã€åˆ†å—è®­ç»ƒ\n\n## çº¿å½¢å›¾\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# æ­å»ºå›¾\ngraph = po(\"scale\") %>>%\n  po(\"encode\") %>>%\n  po(\"imputemedian\") %>>%\n  lrn(\"classif.rpart\")\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å¯è§†åŒ–å›¾\ngraph$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-68-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è½¬ä¸ºå›¾å­¦ä¹ å™¨\ngl = as_learner(graph)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è®­ç»ƒä»»åŠ¡\ntask = tsk(\"iris\")\ngl$train(task)\n```\n:::\n\n\nè°ƒè¯•å›¾ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å–å‡ºæˆ–è®¾ç½®å›¾å­¦ä¹ å™¨è¶…å‚æ•°\ngraph$pipeops$scale$param_set$values$center = FALSE\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è·å–å•ç‹¬PipeOp çš„$stateï¼ˆç»è¿‡$train() åï¼‰\ngraph$keep_results = TRUE\ngraph$train(task)\n#> $classif.rpart.output\n#> NULL\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngraph$pipeops$scale$state$scale\n#> Petal.Length  Petal.Width Sepal.Length  Sepal.Width \n#>     4.163367     1.424451     5.921098     3.098387\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# æŸ¥çœ‹å›¾çš„ä¸­é—´ç»“æœï¼š$.resultï¼ˆéœ€æå‰è®¾ç½®$keep_results = TRUEï¼‰\ngraph$pipeops$scale$.result[[1]]$head()\n#>    Species Petal.Length Petal.Width Sepal.Length Sepal.Width\n#> 1:  setosa    0.3362663    0.140405    0.8613268   1.1296201\n#> 2:  setosa    0.3362663    0.140405    0.8275493   0.9682458\n#> 3:  setosa    0.3122473    0.140405    0.7937718   1.0327956\n#> 4:  setosa    0.3602853    0.140405    0.7768830   1.0005207\n#> 5:  setosa    0.3362663    0.140405    0.8444380   1.1618950\n#> 6:  setosa    0.4083234    0.280810    0.9119931   1.2587196\n```\n:::\n\n\n## éçº¿æ€§å›¾\n\n### åˆ†æ”¯\n\né›†æˆå­¦ä¹ çš„è¢‹è£…æ³•ã€å †å æ³•éƒ½æ˜¯éçº¿æ€§å›¾ï¼Œå¦ä¸€ç§éçº¿æ€§å›¾æ˜¯åˆ†æ”¯ï¼šå³åªæ‰§è¡Œè‹¥å¹²æ¡å¤‡é€‰è·¯å¾„ä¸­çš„ä¸€æ¡ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngraph_branch = ppl(\"branch\", list(\n  pca = po(\"pca\"),\n  ica = po(\"ica\")\n)) %>>%\n  lrn(\"classif.kknn\")\ngraph_branch$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-75-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n### åˆ†å—è®­ç»ƒ\n\nåœ¨æ•°æ®å¤ªå¤§ï¼Œæ— æ³•è½½å…¥å†…å­˜çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¸¸ç”¨çš„æŠ€æœ¯æ˜¯å°†æ•°æ®åˆ†æˆå‡ å—ï¼Œç„¶ååˆ†åˆ«å¯¹å„å—æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œä¹‹åå†ç”¨ PipeOpClassifAvg æˆ– PipeOpRegrAvg å°†æ¨¡å‹æŒ‰åŠ æƒå¹³å‡æ±‡æ€»ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngraph_chunks = po(\"chunk\", 4) %>>%\n  ppl(\"greplicate\", lrn(\"classif.rpart\"), 4) %>>%\n  po(\"classifavg\", 4)\ngraph_chunks$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-76-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è½¬åŒ–ä¸ºå›¾å­¦ä¹ å™¨ï¼Œä¸å­¦ä¹ å™¨ä¸€æ ·ä½¿ç”¨\nchunks_lrn = as_learner(graph_chunks)\nchunks_lrn$train(tsk(\"iris\"))\n```\n:::\n\n\n## é›†æˆå­¦ä¹ \n\né›†æˆå­¦ä¹ ï¼Œæ˜¯é€šè¿‡æ„å»ºå¤šä¸ªåŸºå­¦ä¹ å™¨ï¼Œå¹¶æŒ‰ä¸€å®šç­–ç•¥ç»“åˆæˆå¼ºå­¦ä¹ å™¨æ¥å®Œæˆå­¦ä¹ ä»»åŠ¡ï¼Œå³æ‰€è°“â€œåšé‡‡ä¼—é•¿â€ï¼Œæœ€ç»ˆæ•ˆæœæ˜¯ä¼˜äºä»»ä½•ä¸€ä¸ªåŸå­¦ä¹ å™¨ã€‚é›†æˆå­¦ä¹ å¯ç”¨äºåˆ†ç±»/å›å½’é›†æˆã€ç‰¹å¾é€‰æ‹©é›†æˆã€å¼‚å¸¸å€¼æ£€æµ‹é›†æˆç­‰ã€‚\n\nè¿™å¤šä¸ªåŸºå­¦ä¹ å™¨å¯ä»¥æ˜¯åŒè´¨çš„ï¼Œæ¯”å¦‚éƒ½ç”¨å†³ç­–æ ‘æˆ–éƒ½ç”¨ç¥ç»ç½‘ç»œï¼Œä»¥ Bagging å’Œ Boosting æ¨¡å¼ä¸ºä»£è¡¨ï¼›ä¹Ÿå¯ä»¥æ˜¯å¼‚è´¨çš„ï¼Œå³é‡‡ç”¨ä¸åŒçš„ç®—æ³•ï¼Œä»¥ Stacking æ¨¡å¼ä¸ºä»£è¡¨ã€‚\n\n### è£…è¢‹æ³•ï¼ˆBaggingï¼‰\n\nBagging é‡‡ç”¨çš„æ˜¯å¹¶è¡Œæœºåˆ¶ï¼Œå³åŸºå­¦ä¹ å™¨çš„è®­ç»ƒä¹‹é—´æ²¡æœ‰å‰åé¡ºåºå¯ä»¥åŒæ—¶è¿›è¡Œã€‚\n\nBagging æ˜¯ç”¨â€œæœ‰æ”¾å›â€ æŠ½æ ·ï¼ˆBootstrap æ³•ï¼‰çš„æ–¹å¼æŠ½å–è®­ç»ƒé›†ï¼Œå¯¹äºåŒ…å« $m$ ä¸ªæ ·æœ¬çš„è®­ç»ƒé›†ï¼Œè¿›\nè¡Œ $m$ æ¬¡æœ‰æ”¾å›çš„éšæœºæŠ½æ ·æ“ä½œï¼Œå¾—åˆ°æ ·æœ¬å­é›†ï¼ˆæœ‰é‡å¤ï¼‰ä¸­æœ‰æ¥è¿‘ 36.8% çš„æ ·æœ¬æ²¡æœ‰è¢«æŠ½åˆ°ã€‚\n\næŒ‰ç…§åŒæ ·çš„æ–¹å¼é‡å¤è¿›è¡Œï¼Œå°±å¯ä»¥é‡‡é›†åˆ° $T$ ä¸ªåŒ…å« $m$ ä¸ªæ ·æœ¬çš„æ•°æ®å‰¯æœ¬ï¼Œä»è€Œè®­ç»ƒå‡º $T$ ä¸ªåŸºå­¦ä¹ å™¨ã€‚\n\næœ€ç»ˆå¯¹è¿™ $T$ ä¸ªåŸºå­¦ä¹ å™¨çš„è¾“å‡ºè¿›è¡Œç»“åˆï¼Œåˆ†ç±»é—®é¢˜å°±é‡‡ç”¨â€œå¤šæ•°å†³â€ï¼Œå›å½’é—®é¢˜å°±é‡‡ç”¨â€œå–å¹³å‡â€ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å•åˆ†æ”¯ï¼šæ•°æ®å­æŠ½æ · + å†³ç­–æ ‘\nsingle_path = po(\"subsample\") %>>% lrn(\"classif.rpart\")\n# å¤åˆ¶ 10 æ¬¡å¾—åˆ° 10 ä¸ªåˆ†æ”¯ï¼Œå†æ¥ç±»å¹³å‡\ngraph_bag = ppl(\"greplicate\", single_path, n = 10) %>>%\n  po(\"classifavg\")\n# å¯è§†åŒ–ç»“æ„å…³ç³»\ngraph_bag$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-78-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è½¬ä¸ºå›¾å­¦ä¹ å™¨ï¼Œå¯ä¸æ™®é€šå­¦ä¹ å™¨ä¸€æ ·ä½¿ç”¨\nbaglrn = as_learner(graph_bag)\nbaglrn$train(tsk(\"iris\"))\n```\n:::\n\n\n### æå‡æ³•ï¼ˆBoostingï¼‰\n\nBoosting é‡‡ç”¨çš„æ˜¯ä¸²è¡Œæœºåˆ¶ï¼Œå³åŸºå­¦ä¹ å™¨çš„è®­ç»ƒå­˜åœ¨ä¾èµ–å…³ç³»ï¼ŒæŒ‰æ¬¡åºä¸€ä¸€è¿›è¡Œè®­ç»ƒï¼ˆå®ç°ä¸Šå¯ä»¥åš\nåˆ°å¹¶è¡Œï¼‰ã€‚\n\nåŸºæœ¬æ€æƒ³ï¼šåŸºæ¨¡å‹çš„è®­ç»ƒé›†æŒ‰ç…§æŸç§ç­–ç•¥æ¯æ¬¡éƒ½è¿›è¡Œä¸€å®šçš„è½¬åŒ–ï¼Œå¯¹æ‰€æœ‰åŸºæ¨¡å‹é¢„æµ‹çš„ç»“æœè¿›è¡Œçº¿æ€§åˆ\næˆäº§ç”Ÿæœ€ç»ˆçš„é¢„æµ‹ç»“æœã€‚\n\nä»åå·®-æ–¹å·®åˆ†è§£æ¥çœ‹ï¼ŒBoosting ç®—æ³•ä¸»è¦å…³æ³¨äºé™ä½åå·®ï¼Œæ¯è½®çš„è¿­ä»£éƒ½å…³æ³¨äºè®­ç»ƒè¿‡ç¨‹ä¸­é¢„æµ‹é”™è¯¯çš„æ ·æœ¬ï¼Œå°†å¼±å­¦ä¹ å™¨æå‡ä¸ºå¼ºå­¦ä¹ å™¨ã€‚\n\n### å †å æ³•ï¼ˆStackingï¼‰\n\nStacking æ³•ï¼Œé‡‡ç”¨çš„æ˜¯åˆ†é˜¶æ®µæœºåˆ¶ï¼Œå°†è‹¥å¹²åŸºæ¨¡å‹çš„è¾“å‡ºä½œä¸ºè¾“å…¥ï¼Œå†æ¥ä¸€å±‚ä¸»å­¦ä¹ å™¨ï¼Œå¾—åˆ°æœ€ç»ˆçš„é¢„æµ‹ã€‚\n\nå°†è®­ç»ƒå¥½çš„æ‰€æœ‰åŸºæ¨¡å‹å¯¹è®­ç»ƒé›†è¿›è¡Œé¢„æµ‹ï¼Œç¬¬ $j$ ä¸ªåŸºæ¨¡å‹å¯¹ç¬¬ $i$ ä¸ªè®­ç»ƒæ ·æœ¬çš„é¢„æµ‹å€¼å°†ä½œä¸ºæ–°çš„è®­ç»ƒé›†ä¸­ç¬¬ $i$ ä¸ªæ ·æœ¬çš„ç¬¬ $j$ ä¸ªç‰¹å¾å€¼ï¼Œæœ€ååŸºäºæ–°çš„è®­ç»ƒé›†è¿›è¡Œè®­ç»ƒã€‚åŒç†ï¼Œé¢„æµ‹çš„è¿‡ç¨‹ä¹Ÿè¦å…ˆç»è¿‡æ‰€æœ‰åŸºæ¨¡å‹çš„é¢„æµ‹å½¢æˆæ–°çš„æµ‹è¯•é›†ï¼Œæœ€åå†å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹ã€‚\n\nç”¨äºå †å çš„åŸºæ¨¡å‹é€šå¸¸é‡‡ç”¨ä¸åŒçš„æ¨¡å‹ï¼Œä½œç”¨åœ¨ç›¸åŒçš„è®­ç»ƒé›†ä¸Šã€‚\n\nä¸ºäº†å……åˆ†åˆ©ç”¨æ•°æ®ï¼ŒStacking é€šå¸¸é‡‡ç”¨ $k$ æŠ˜äº¤å‰è®­ç»ƒæ³•ï¼ˆç±»ä¼¼ $k$ æŠ˜äº¤å‰éªŒè¯ï¼‰ï¼šæ¯ä¸ªåŸºå­¦ä¹ å™¨åˆ†åˆ«åœ¨å„ä¸ª $k-1$ æŠ˜æ•°æ®ä¸Šè®­ç»ƒï¼Œåœ¨å…¶å‰©ä¸‹çš„ 1 æŠ˜æ•°æ®ä¸Šé¢„æµ‹ï¼Œå°±å¯ä»¥å¾—åˆ°å¯¹ä»»æ„ 1 æŠ˜æ•°æ®çš„é¢„æµ‹ç»“æœï¼Œè¿›è€Œç”¨äºè®­ç»ƒä¸»æ¨¡å‹ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngraph_stack = gunion(list(\n  po(\"learner_cv\", lrn(\"regr.lm\")),\n  po(\"learner_cv\", lrn(\"regr.svm\")),\n  po(\"nop\")\n)) %>>%\n  po(\"featureunion\") %>>%\n  lrn(\"regr.ranger\")\n\ngraph_stack$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-80-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è½¬ä¸ºå›¾å­¦ä¹ å™¨ï¼Œå¯ä¸æ™®é€šå­¦ä¹ å™¨ä¸€æ ·ä½¿ç”¨\nstacklrn = as_learner(graph_stack)\nstacklrn$train(tsk(\"mtcars\"))\n```\n:::\n\n\n# ç‰¹å¾å·¥ç¨‹\n\næœºå™¨å­¦ä¹ ä¸­çš„æ•°æ®é¢„å¤„ç†ï¼Œé€šå¸¸ä¹Ÿç»Ÿç§°ä¸ºç‰¹å¾å·¥ç¨‹ï¼Œä¸»è¦åŒ…æ‹¬ï¼šç¼ºå¤±å€¼æ’è¡¥ã€ç‰¹å¾å˜æ¢ï¼Œç›®çš„æ˜¯æå‡æ¨¡å‹æ€§èƒ½ã€‚\n\n## ç‰¹å¾å·¥ç¨‹æ¦‚è¿°\n\nç”¨ mlr3pipelines åŒ…å®ç°ç‰¹å¾å·¥ç¨‹ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# æŸ¥çœ‹æ‰€æœ‰ PipeOp\npo()\n#> <DictionaryPipeOp> with 64 stored values\n#> Keys: boxcox, branch, chunk, classbalancing, classifavg, classweights,\n#>   colapply, collapsefactors, colroles, copy, datefeatures, encode,\n#>   encodeimpact, encodelmer, featureunion, filter, fixfactors, histbin,\n#>   ica, imputeconstant, imputehist, imputelearner, imputemean,\n#>   imputemedian, imputemode, imputeoor, imputesample, kernelpca,\n#>   learner, learner_cv, missind, modelmatrix, multiplicityexply,\n#>   multiplicityimply, mutate, nmf, nop, ovrsplit, ovrunite, pca, proxy,\n#>   quantilebin, randomprojection, randomresponse, regravg,\n#>   removeconstants, renamecolumns, replicate, scale, scalemaxabs,\n#>   scalerange, select, smote, spatialsign, subsample, targetinvert,\n#>   targetmutate, targettrafoscalerange, textvectorizer, threshold,\n#>   tunethreshold, unbranch, vtreat, yeojohnson\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngr = po(\"scale\") %>>% po(\"pca\", rank. = 2)\ngr$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-83-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nç‰¹å¾å·¥ç¨‹ç®¡é“çš„ä¸‰ç§ç”¨æ³•ï¼š\n\n1. <p>è°ƒè¯•ï¼šæŸ¥çœ‹ç‰¹å¾å·¥ç¨‹æ­¥å¯¹è¾“å…¥æ•°æ®åšäº†ä»€ä¹ˆ</p>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è®­ç»ƒç‰¹å¾å·¥ç¨‹ç®¡é“ï¼šæä¾›ä»»åŠ¡ï¼Œè®¿é—®ç‰¹å¾å·¥ç¨‹ä¹‹åçš„æ•°æ®\ntask = tsk(\"iris\")\ngr$train(task)[[1]]$data()\n#>        Species        PC1         PC2\n#>   1:    setosa -2.2571412 -0.47842383\n#>   2:    setosa -2.0740130  0.67188269\n#>   3:    setosa -2.3563351  0.34076642\n#>   4:    setosa -2.2917068  0.59539986\n#>   5:    setosa -2.3818627 -0.64467566\n#>  ---                                 \n#> 146: virginica  1.8642579 -0.38567404\n#> 147: virginica  1.5593565  0.89369285\n#> 148: virginica  1.5160915 -0.26817075\n#> 149: virginica  1.3682042 -1.00787793\n#> 150: virginica  0.9574485  0.02425043\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å°†è®­ç»ƒå¥½çš„ç‰¹å¾å·¥ç¨‹ç®¡é“ï¼Œç”¨äºæ–°çš„æ•°æ®\ngr$predict(task$filter(1:5))[[1]]$data()\n#>    Species       PC1        PC2\n#> 1:  setosa -2.257141 -0.4784238\n#> 2:  setosa -2.074013  0.6718827\n#> 3:  setosa -2.356335  0.3407664\n#> 4:  setosa -2.291707  0.5953999\n#> 5:  setosa -2.381863 -0.6446757\n```\n:::\n\n\n2. <p>ç”¨äºæœºå™¨å­¦ä¹ ï¼šåŸå§‹ä»»åŠ¡ç»è¿‡ç‰¹å¾å·¥ç¨‹ç®¡é“å˜æˆé¢„å¤„ç†ä¹‹åçš„ä»»åŠ¡ï¼Œå†æ­£å¸¸ç”¨äºæœºå™¨å­¦ä¹ æµç¨‹</p>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nnewtask = gr$train(task)[[1]]\nnewtask\n#> <TaskClassif:iris> (5 x 3): Iris Flowers\n#> * Target: Species\n#> * Properties: multiclass\n#> * Features (2):\n#>   - dbl (2): PC1, PC2\n```\n:::\n\n\n3. <p>ç”¨äºæœºå™¨å­¦ä¹ ï¼šå†æ¥ä¸€ä¸ªå­¦ä¹ å™¨ï¼Œè½¬åŒ–æˆå›¾å­¦ä¹ å™¨ï¼ŒåŒæ™®é€šå­¦ä¹ å™¨ä¸€æ ·ä½¿ç”¨ï¼Œé€‚åˆå¯¹ç‰¹å¾å·¥ç¨‹æ­¥ã€ML ç®—æ³•ä¸€èµ·è”åŠ¨è°ƒå‚</p>\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngr = gr %>>% lrn(\"classif.rpart\")\ngr$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-87-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngr_learner = as_learner(gr)\ngr_learner\n#> <GraphLearner:scale.pca.classif.rpart>\n#> * Model: -\n#> * Parameters: scale.robust=FALSE, pca.rank.=2, classif.rpart.xval=0\n#> * Packages: mlr3, mlr3pipelines, rpart\n#> * Predict Types:  [response], prob\n#> * Feature Types: logical, integer, numeric, character, factor, ordered,\n#>   POSIXct\n#> * Properties: featureless, hotstart_backward, hotstart_forward,\n#>   importance, loglik, missings, multiclass, oob_error,\n#>   selected_features, twoclass, weights\n```\n:::\n\n\n## ç¼ºå¤±å€¼æ’è¡¥\n\nç›®å‰æ”¯æŒçš„æ’è¡¥æ–¹æ³•ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nas.data.table(mlr_pipeops)[tags %in% \"missings\", \"key\"]\n#>               key\n#> 1: imputeconstant\n#> 2:     imputehist\n#> 3:  imputelearner\n#> 4:     imputemean\n#> 5:   imputemedian\n#> 6:     imputemode\n#> 7:      imputeoor\n#> 8:   imputesample\n```\n:::\n\n\n### ç®€å•æ’è¡¥\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"pima\")\ntask$missings()\n#> diabetes      age  glucose  insulin     mass pedigree pregnant pressure \n#>        0        0        5      374       11        0        0       35 \n#>  triceps \n#>      227\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å¸¸æ•°æ’è¡¥\npo = po(\"imputeconstant\", param_vals = list(\n  constant = -999, affect_columns = selector_name(\"glucose\")\n))\nnew_task = po$train(list(task = task))[[1]]\nnew_task$missings()\n#> diabetes      age  insulin     mass pedigree pregnant pressure  triceps \n#>        0        0      374       11        0        0       35      227 \n#>  glucose \n#>        0\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å‡å€¼æ’è¡¥\npo = po(\"imputemean\")\nnew_task = po$train(list(task = task))[[1]]\nnew_task$missings()\n#> diabetes      age pedigree pregnant  glucose  insulin     mass pressure \n#>        0        0        0        0        0        0        0        0 \n#>  triceps \n#>        0\n```\n:::\n\n\n### éšæœºæŠ½æ ·æ’è¡¥\n\né€šè¿‡ä»éç¼ºå¤±çš„è®­ç»ƒæ•°æ®ä¸­éšæœºæŠ½æ ·æ¥æ’è¡¥ç‰¹å¾ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npo = po(\"imputesample\")\nnew_task = po$train(list(task = task))[[1]]\nnew_task$missings()\n#> diabetes      age pedigree pregnant  glucose  insulin     mass pressure \n#>        0        0        0        0        0        0        0        0 \n#>  triceps \n#>        0\n```\n:::\n\n\n### ç›´æ–¹å›¾æ³•æ’è¡¥\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npo = po(\"imputehist\")\nnew_task = po$train(list(task = task))[[1]]\nnew_task$missings()\n#> diabetes      age pedigree pregnant  glucose  insulin     mass pressure \n#>        0        0        0        0        0        0        0        0 \n#>  triceps \n#>        0\n```\n:::\n\n\n### å­¦ä¹ å™¨æ’è¡¥\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å†³ç­–æ ‘æ’è¡¥\npo = po(\"imputelearner\", lrn(\"regr.rpart\"))\nnew_task = po$train(list(task = task))[[1]]\nnew_task$missings()\n#> diabetes      age pedigree pregnant  glucose  insulin     mass pressure \n#>        0        0        0        0        0        0        0        0 \n#>  triceps \n#>        0\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# KNNæ’è¡¥ï¼Œè®­ç»ƒKNNå­¦ä¹ å™¨æ—¶ï¼Œå…ˆç”¨ç›´æ–¹å›¾æ³•æ’è¡¥\npo = po(\"imputelearner\", \n        po(\"imputehist\") %>>% lrn(\"regr.kknn\"))\nnew_task = po$train(list(task = task))[[1]]\nnew_task$missings()\n#> diabetes      age pedigree pregnant  glucose  insulin     mass pressure \n#>        0        0        0        0        0        0        0        0 \n#>  triceps \n#>        0\n```\n:::\n\n\n## ç‰¹å¾å·¥ç¨‹\n\n### ç‰¹å¾ç¼©æ”¾\n\nä¸åŒæ•°å€¼å‹ç‰¹å¾çš„æ•°æ®é‡çº²å¯èƒ½ç›¸å·®å¤šä¸ªæ•°é‡çº§ï¼Œè¿™å¯¹å¾ˆå¤šæ•°æ®æ¨¡å‹ä¼šæœ‰å¾ˆå¤§å½±å“ï¼Œæ‰€ä»¥æœ‰å¿…è¦åšå½’ä¸€åŒ–å¤„ç†ï¼Œå°±æ˜¯å°†åˆ—æˆ–è¡Œå¯¹é½å¹¶è½¬åŒ–ä¸ºä¸€è‡´ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ndf = as_tibble(iris) %>% \n  set_names(str_c(\"x\", 1:4), \"Species\")\ntask = as_task_classif(df, target = \"Species\")\n```\n:::\n\n\n#### æ ‡å‡†åŒ–\n\næ ‡å‡†åŒ–ä¹Ÿç§°ä¸º Z æ ‡å‡†åŒ–ï¼Œå°†æ•°æ®å˜æˆå‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 1ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npos = po(\"scale\")  # å‚æ•° scale = FALSEï¼Œåªåšä¸­å¿ƒåŒ–\npos$train(list(task))[[1]]$data()\n#>        Species          x1          x2         x3         x4\n#>   1:    setosa -0.89767388  1.01560199 -1.3357516 -1.3110521\n#>   2:    setosa -1.13920048 -0.13153881 -1.3357516 -1.3110521\n#>   3:    setosa -1.38072709  0.32731751 -1.3923993 -1.3110521\n#>   4:    setosa -1.50149039  0.09788935 -1.2791040 -1.3110521\n#>   5:    setosa -1.01843718  1.24503015 -1.3357516 -1.3110521\n#>  ---                                                        \n#> 146: virginica  1.03453895 -0.13153881  0.8168591  1.4439941\n#> 147: virginica  0.55148575 -1.27867961  0.7035638  0.9192234\n#> 148: virginica  0.79301235 -0.13153881  0.8168591  1.0504160\n#> 149: virginica  0.43072244  0.78617383  0.9301544  1.4439941\n#> 150: virginica  0.06843254 -0.13153881  0.7602115  0.7880307\n```\n:::\n\n\næ³¨ï¼šä¸­å¿ƒåŒ–åï¼Œ0 å°±ä»£è¡¨å‡å€¼ï¼Œæ›´æ–¹ä¾¿æ¨¡å‹è§£é‡Šã€‚\n\n#### å½’ä¸€åŒ–\n\nå½’ä¸€åŒ–æ˜¯å°†æ•°æ®çº¿æ€§æ”¾ç¼©åˆ° $\\left[0, 1\\right]$ï¼ˆæ ¹æ®éœ€è¦ä¹Ÿå¯ä»¥çº¿æ€§æ”¾ç¼©åˆ° $\\left[a, b\\right]$ï¼‰, ä¸€èˆ¬è¿˜åŒæ—¶è€ƒè™‘æŒ‡æ ‡ä¸€è‡´åŒ–ï¼Œå°†æ­£å‘æŒ‡æ ‡ï¼ˆå€¼è¶Šå¤§è¶Šå¥½ï¼‰å’Œè´Ÿå‘æŒ‡æ ‡ï¼ˆå€¼è¶Šå°è¶Šå¥½ï¼‰éƒ½å˜æˆæ­£å‘ã€‚\n\næ­£å‘æŒ‡æ ‡ï¼š\n\n$$\nx_i'=\\frac{x_i - \\text{min} x_i}{\\text{max} x_i - \\text{min} x_i}\n$$\n\nè´Ÿå‘æŒ‡æ ‡ï¼š\n\n$$\nx_i'=\\frac{\\text{max} x_i - x_i}{\\text{max} x_i - \\text{min} x_i}\n$$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npop = po(\"scalerange\", param_vals = list(lower = 0, upper = 1))\npop$train(list(task))[[1]]$data()\n#>        Species         x1        x2         x3         x4\n#>   1:    setosa 0.22222222 0.6250000 0.06779661 0.04166667\n#>   2:    setosa 0.16666667 0.4166667 0.06779661 0.04166667\n#>   3:    setosa 0.11111111 0.5000000 0.05084746 0.04166667\n#>   4:    setosa 0.08333333 0.4583333 0.08474576 0.04166667\n#>   5:    setosa 0.19444444 0.6666667 0.06779661 0.04166667\n#>  ---                                                     \n#> 146: virginica 0.66666667 0.4166667 0.71186441 0.91666667\n#> 147: virginica 0.55555556 0.2083333 0.67796610 0.75000000\n#> 148: virginica 0.61111111 0.4166667 0.71186441 0.79166667\n#> 149: virginica 0.52777778 0.5833333 0.74576271 0.91666667\n#> 150: virginica 0.44444444 0.4166667 0.69491525 0.70833333\n```\n:::\n\n\n#### è¡Œè§„èŒƒåŒ–\n\nè¡Œè§„èŒƒåŒ–ï¼Œå¸¸ç”¨äºæ–‡æœ¬æ•°æ®æˆ–èšç±»ç®—æ³•ï¼Œæ˜¯ä¿è¯æ¯è¡Œå…·æœ‰å•ä½èŒƒæ•°ï¼Œå³æ¯è¡Œçš„å‘é‡â€œé•¿åº¦â€ç›¸åŒã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œ$m$ ä¸ªç‰¹å¾ä¸‹ï¼Œæ¯è¡Œæ•°æ®éƒ½æ˜¯ $m$ ç»´ç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œåšè¡Œè§„èŒƒåŒ–èƒ½è®©è¿™äº›ç‚¹éƒ½è½åœ¨å•ä½çƒé¢ä¸Šï¼ˆåˆ°åŸç‚¹çš„è·ç¦»å‡ä¸º 1ï¼‰ã€‚\n\nè¡Œè§„èŒƒåŒ–ä¸€èˆ¬é‡‡ç”¨ L2 èŒƒæ•°ï¼š\n\n$$\nx_{ij}' = \\frac{x_{ij}}{\\|x_i\\|} = \\frac{x_{ij}}{\\sqrt{\\sum_{j=1}^m x_{ij}^2}}\n$$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npop = po(\"spatialsign\")\npop$train(list(task))[[1]]$data()\n#>        Species        x1        x2        x3         x4\n#>   1:    setosa 0.8037728 0.5516088 0.2206435 0.03152050\n#>   2:    setosa 0.8281329 0.5070201 0.2366094 0.03380134\n#>   3:    setosa 0.8053331 0.5483119 0.2227517 0.03426949\n#>   4:    setosa 0.8000302 0.5391508 0.2608794 0.03478392\n#>   5:    setosa 0.7909650 0.5694948 0.2214702 0.03163860\n#>  ---                                                   \n#> 146: virginica 0.7215572 0.3230853 0.5600146 0.24769876\n#> 147: virginica 0.7296536 0.2895451 0.5790902 0.22005426\n#> 148: virginica 0.7165390 0.3307103 0.5732312 0.22047353\n#> 149: virginica 0.6746707 0.3699807 0.5876164 0.25028107\n#> 150: virginica 0.6902592 0.3509792 0.5966647 0.21058754\n```\n:::\n\n\n### ç‰¹å¾å˜æ¢\n\n#### éçº¿æ€§ç‰¹å¾\n\nå¯¹äºæ•°å€¼ç‰¹å¾ $x_1, x_2, \\cdots$ï¼Œå¯ä»¥ç©¿ä»¶æ›´å¤šçš„å¤šé¡¹å¼ç‰¹å¾ï¼š$x_1^2, x_1, x_2^2, x2, \\cdots$ï¼Œè¿™ç›¸å½“äºæ˜¯ç”¨è‡ªå˜é‡çš„æ›´é«˜é˜¶æ³°å‹’å…¬å¼å»é€¼è¿‘å› å˜é‡ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npop = po(\"modelmatrix\", formula = ~ . ^ 2 + I(x1 ^ 2) + log(x2))\npop$train(list(task))[[1]]$data()\n#>        Species (Intercept)  x1  x2  x3  x4 I(x1^2)   log(x2) x1:x2 x1:x3 x1:x4\n#>   1:    setosa           1 5.1 3.5 1.4 0.2   26.01 1.2527630 17.85  7.14  1.02\n#>   2:    setosa           1 4.9 3.0 1.4 0.2   24.01 1.0986123 14.70  6.86  0.98\n#>   3:    setosa           1 4.7 3.2 1.3 0.2   22.09 1.1631508 15.04  6.11  0.94\n#>   4:    setosa           1 4.6 3.1 1.5 0.2   21.16 1.1314021 14.26  6.90  0.92\n#>   5:    setosa           1 5.0 3.6 1.4 0.2   25.00 1.2809338 18.00  7.00  1.00\n#>  ---                                                                          \n#> 146: virginica           1 6.7 3.0 5.2 2.3   44.89 1.0986123 20.10 34.84 15.41\n#> 147: virginica           1 6.3 2.5 5.0 1.9   39.69 0.9162907 15.75 31.50 11.97\n#> 148: virginica           1 6.5 3.0 5.2 2.0   42.25 1.0986123 19.50 33.80 13.00\n#> 149: virginica           1 6.2 3.4 5.4 2.3   38.44 1.2237754 21.08 33.48 14.26\n#> 150: virginica           1 5.9 3.0 5.1 1.8   34.81 1.0986123 17.70 30.09 10.62\n#>      x2:x3 x2:x4 x3:x4\n#>   1:  4.90  0.70  0.28\n#>   2:  4.20  0.60  0.28\n#>   3:  4.16  0.64  0.26\n#>   4:  4.65  0.62  0.30\n#>   5:  5.04  0.72  0.28\n#>  ---                  \n#> 146: 15.60  6.90 11.96\n#> 147: 12.50  4.75  9.50\n#> 148: 15.60  6.00 10.40\n#> 149: 18.36  7.82 12.42\n#> 150: 15.30  5.40  9.18\n```\n:::\n\n\nå¦ä¸€ç§å¸¸ç”¨çš„éçº¿æ€§ç‰¹å¾æ˜¯åŸºäºè‡ªç„¶æ ·æ¡çš„æ ·æ¡ç‰¹å¾ï¼ˆæš‚æ—¶æ²¡æœ‰ä¸“é—¨çš„PipeOpï¼‰ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npop = po(\"modelmatrix\", formula = ~ splines::ns(x1, 5))\npop$train(list(task))[[1]]$data()\n#>        Species (Intercept) splines::ns(x1, 5)1 splines::ns(x1, 5)2\n#>   1:    setosa           1        3.094150e-01        0.0009968102\n#>   2:    setosa           1        1.318681e-01        0.0000000000\n#>   3:    setosa           1        3.907204e-02        0.0000000000\n#>   4:    setosa           1        1.648352e-02        0.0000000000\n#>   5:    setosa           1        2.094017e-01        0.0000000000\n#>  ---                                                              \n#> 146: virginica           1        0.000000e+00        0.3024574669\n#> 147: virginica           1        1.812956e-02        0.6788378608\n#> 148: virginica           1        1.362101e-05        0.4802626315\n#> 149: virginica           1        5.579165e-02        0.7426950594\n#> 150: virginica           1        3.630706e-01        0.6033287054\n#>      splines::ns(x1, 5)3 splines::ns(x1, 5)4 splines::ns(x1, 5)5\n#>   1:         -0.20323541          0.46832508        -0.265089667\n#>   2:         -0.21657099          0.49905488        -0.282483895\n#>   3:         -0.17532519          0.40401021        -0.228685025\n#>   4:         -0.13961683          0.32172574        -0.182108907\n#>   5:         -0.21746675          0.50111903        -0.283652281\n#>  ---                                                            \n#> 146:          0.52049703          0.20822647        -0.031180964\n#> 147:          0.26175304          0.08745429        -0.046174752\n#> 148:          0.42721751          0.15182156        -0.059315324\n#> 149:          0.17592803          0.05799882        -0.032413564\n#> 150:          0.01963969          0.01354992        -0.007669769\n```\n:::\n\n\n#### è®¡ç®—æ–°ç‰¹å¾\n\nç®¡é“è¿ç®—â€œmutateâ€ï¼Œæ ¹æ®ä»¥å…¬å¼å½¢å¼ç»™å‡ºçš„è¡¨è¾¾å¼æ·»åŠ ç‰¹å¾ï¼Œè¿™äº›è¡¨è¾¾å¼å¯èƒ½å–å†³äºå…¶ä»–ç‰¹å¾çš„å€¼ã€‚è¿™å¯ä»¥å¢åŠ æ–°çš„ç‰¹å¾ï¼Œä¹Ÿå¯ä»¥æ”¹å˜ç°æœ‰çš„ç‰¹å¾ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npom = po(\"mutate\", mutation = list(\n  x1_p = ~ x1 + 1,\n  Area1 = ~ x1 * x2,\n  Area2 = ~ x3 * x4,\n  Area = ~ Area1 + Area2\n))\npom$train(list(task))[[1]]$data()\n#>        Species  x1  x2  x3  x4 x1_p Area1 Area2  Area\n#>   1:    setosa 5.1 3.5 1.4 0.2  6.1 17.85  0.28 18.13\n#>   2:    setosa 4.9 3.0 1.4 0.2  5.9 14.70  0.28 14.98\n#>   3:    setosa 4.7 3.2 1.3 0.2  5.7 15.04  0.26 15.30\n#>   4:    setosa 4.6 3.1 1.5 0.2  5.6 14.26  0.30 14.56\n#>   5:    setosa 5.0 3.6 1.4 0.2  6.0 18.00  0.28 18.28\n#>  ---                                                 \n#> 146: virginica 6.7 3.0 5.2 2.3  7.7 20.10 11.96 32.06\n#> 147: virginica 6.3 2.5 5.0 1.9  7.3 15.75  9.50 25.25\n#> 148: virginica 6.5 3.0 5.2 2.0  7.5 19.50 10.40 29.90\n#> 149: virginica 6.2 3.4 5.4 2.3  7.2 21.08 12.42 33.50\n#> 150: virginica 5.9 3.0 5.1 1.8  6.9 17.70  9.18 26.88\n```\n:::\n\n\nåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼ä»å¤æ‚å­—ç¬¦ä¸²åˆ—æå–å‡ºç›¸å…³ä¿¡æ¯ï¼Œå¹¶è½¬åŒ–ä¸ºå› å­ç‰¹å¾ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npo_ftextract = po(\"mutate\", mutation = list(\n  fare_per_person = ~ fare / (parch + sib_sp + 1),\n  deck = ~ factor(str_sub(cabin, 1, 1)),\n  title = ~ factor(str_extract(name, \"(?<=, ).*(?=\\\\.)\")),\n  surname = ~ factor(str_extract(name, \"^.*(?=,)\")),\n  ticket_prefix = ~ factor(str_extract(ticket, \"^.*(?= )\"))\n))\npo_ftextract$train(list(tsk(\"titanic\")))[[1]]$data()\n#>       survived  age cabin embarked     fare\n#>    1:       no 22.0  <NA>        S   7.2500\n#>    2:      yes 38.0   C85        C  71.2833\n#>    3:      yes 26.0  <NA>        S   7.9250\n#>    4:      yes 35.0  C123        S  53.1000\n#>    5:       no 35.0  <NA>        S   8.0500\n#>   ---                                      \n#> 1305:     <NA>   NA  <NA>        S   8.0500\n#> 1306:     <NA> 39.0  C105        C 108.9000\n#> 1307:     <NA> 38.5  <NA>        S   7.2500\n#> 1308:     <NA>   NA  <NA>        S   8.0500\n#> 1309:     <NA>   NA  <NA>        C  22.3583\n#>                                                      name parch pclass    sex\n#>    1:                             Braund, Mr. Owen Harris     0      3   male\n#>    2: Cumings, Mrs. John Bradley (Florence Briggs Thayer)     0      1 female\n#>    3:                              Heikkinen, Miss. Laina     0      3 female\n#>    4:        Futrelle, Mrs. Jacques Heath (Lily May Peel)     0      1 female\n#>    5:                            Allen, Mr. William Henry     0      3   male\n#>   ---                                                                        \n#> 1305:                                  Spector, Mr. Woolf     0      3   male\n#> 1306:                        Oliva y Ocana, Dona. Fermina     0      1 female\n#> 1307:                        Saether, Mr. Simon Sivertsen     0      3   male\n#> 1308:                                 Ware, Mr. Frederick     0      3   male\n#> 1309:                            Peter, Master. Michael J     1      3   male\n#>       sib_sp             ticket fare_per_person deck  title       surname\n#>    1:      1          A/5 21171        3.625000 <NA>     Mr        Braund\n#>    2:      1           PC 17599       35.641650    C    Mrs       Cumings\n#>    3:      0   STON/O2. 3101282        7.925000 <NA>   Miss     Heikkinen\n#>    4:      1             113803       26.550000    C    Mrs      Futrelle\n#>    5:      0             373450        8.050000 <NA>     Mr         Allen\n#>   ---                                                                    \n#> 1305:      0          A.5. 3236        8.050000 <NA>     Mr       Spector\n#> 1306:      0           PC 17758      108.900000    C   Dona Oliva y Ocana\n#> 1307:      0 SOTON/O.Q. 3101262        7.250000 <NA>     Mr       Saether\n#> 1308:      0             359309        8.050000 <NA>     Mr          Ware\n#> 1309:      1               2668        7.452767 <NA> Master         Peter\n#>       ticket_prefix\n#>    1:           A/5\n#>    2:            PC\n#>    3:      STON/O2.\n#>    4:          <NA>\n#>    5:          <NA>\n#>   ---              \n#> 1305:          A.5.\n#> 1306:            PC\n#> 1307:    SOTON/O.Q.\n#> 1308:          <NA>\n#> 1309:          <NA>\n```\n:::\n\n\nè‹¥æ•°æ®å™ªå£°å¤ªå¤šçš„é—®é¢˜ï¼Œé€šå¸¸å°±éœ€è¦åšæ•°æ®å¹³æ»‘ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npom = po(\"mutate\", mutation = list(\n  x1_s = ~ slider::slide_dbl(x1, mean, .before = 2, .after = 2) # äº”ç‚¹ç§»åŠ¨å¹³å‡\n))\ndat = pom$train(list(task = task))[[1]]$data()\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(patchwork)\np1 = ggplot(dat, aes(1:150, x1)) + geom_line()\np2 = ggplot(dat, aes(1:150, x1_s)) + geom_line()\np1 / p2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-106-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# colapplyï¼šåº”ç”¨å‡½æ•°åˆ°ä»»åŠ¡çš„æ¯ä¸€åˆ—ï¼Œå¸¸ç”¨äºç±»å‹è½¬æ¢\npoca = po(\"colapply\", applicator = as.character)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# renamecolumnsï¼šä¿®æ”¹åˆ—å\npop = po(\"renamecolumns\", param_vals = list(\n  renaming = c(\"Petal.Length\" = \"PL\")\n))\n```\n:::\n\n\n#### æ­£æ€æ€§å˜æ¢\n\nBox-Cox å˜æ¢æ˜¯æ›´ç¥å¥‡çš„æ­£æ€æ€§å˜æ¢ï¼Œç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡é€‰æ‹©æœ€ä¼˜çš„ $\\lambda$ å€¼ï¼Œè®©éè´Ÿçš„éæ­£æ€æ•°æ®å˜æˆæ­£æ€æ•°æ®ï¼š\n\n$$\ny' = \n\\begin{cases}\n\\ln y  & \\lambda = 0 \\\\\n(y^{\\lambda} - 1)/ \\lambda  & \\lambda \\neq 0\n\\end{cases}\n$$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npop = po(\"boxcox\")\npop$train(list(task))[[1]]$data()\n#>        Species         x1          x2         x3         x4\n#>   1:    setosa -0.8917547  1.01831791 -1.3431567 -1.3850773\n#>   2:    setosa -1.1812229 -0.08167295 -1.3431567 -1.3850773\n#>   3:    setosa -1.4845435  0.37307046 -1.4033413 -1.3850773\n#>   4:    setosa -1.6417967  0.14833599 -1.2832670 -1.3850773\n#>   5:    setosa -1.0348319  1.22454068 -1.3431567 -1.3850773\n#>  ---                                                       \n#> 146: virginica  1.0385560 -0.08167295  0.8174171  1.2930924\n#> 147: virginica  0.6097200 -1.32264877  0.7075555  0.9020852\n#> 148: virginica  0.8279148 -0.08167295  0.8174171  1.0023867\n#> 149: virginica  0.4976284  0.80781419  0.9269887  1.2930924\n#> 150: virginica  0.1485189 -0.08167295  0.7625234  0.7998822\n```\n:::\n\n\nè‹¥æ•°æ®åŒ…å« 0 æˆ–è´Ÿæ•°ï¼Œåˆ™ Box-Cox å˜æ¢ä¸å†é€‚ç”¨ï¼Œå¯ä»¥æ”¹ç”¨åŒæ ·åŸç†çš„ Yeo-Johnson å˜æ¢ï¼š\n\n$$\ny' = \n\\begin{cases}\n\\ln (y+1)                                 & \\lambda = 0, y \\geq 0\\\\\n\\frac{(y + 1)^{\\lambda} - 1}{\\lambda}     & \\lambda \\neq 0, y \\geq 0\\\\\n- \\ln (1-y)                               & \\lambda = 2, y < 0\\\\\n\\frac{(1-y)^{2-\\lambda} - 1}{\\lambda - 2} & \\lambda \\neq 2, y < 0\n\\end{cases}\n$$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npop = po(\"yeojohnson\")\npop$train(list(task))[[1]]$data()\n#>        Species         x1          x2         x3         x4\n#>   1:    setosa -0.8926989  1.01949272 -1.3278574 -1.3278174\n#>   2:    setosa -1.1812158 -0.08164367 -1.3278574 -1.3278174\n#>   3:    setosa -1.4829526  0.37387369 -1.3813346 -1.3278174\n#>   4:    setosa -1.6391179  0.14878429 -1.2741721 -1.3278174\n#>   5:    setosa -1.0353690  1.22553197 -1.3278574 -1.3278174\n#>  ---                                                       \n#> 146: virginica  1.0393000 -0.08164367  0.8157632  1.4105911\n#> 147: virginica  0.6095086 -1.32389503  0.6988626  0.9184998\n#> 148: virginica  0.8281903 -0.08164367  0.8157632  1.0424849\n#> 149: virginica  0.4971768  0.80900587  0.9330158  1.4105911\n#> 150: virginica  0.1474204 -0.08164367  0.7572682  0.7938307\n```\n:::\n\n\n#### è¿ç»­å˜é‡åˆ†ç®±\n\nåœ¨ç»Ÿè®¡å’Œæœºå™¨å­¦ä¹ ä¸­ï¼Œæœ‰æ—¶éœ€è¦å°†è¿ç»­å˜é‡è½¬åŒ–ä¸ºç¦»æ•£å˜é‡ï¼Œç§°ä¸ºè¿ç»­å˜é‡ç¦»æ•£åŒ–æˆ–åˆ†ç®±ï¼Œå¸¸ç”¨äºé“¶è¡Œé£æ§å»ºæ¨¡ï¼Œç‰¹åˆ«æ˜¯çº¿æ€§å›å½’æˆ– Logistic å›å½’æ¨¡å‹ã€‚\n\nåˆ†ç®±çš„å¥½å¤„æœ‰ï¼š\n\n1. ä½¿å¾—ç»“æœæ›´ä¾¿äºåˆ†æå’Œè§£é‡Šã€‚æ¯”å¦‚ï¼Œå¹´é¾„ä»ä¸­å¹´åˆ°è€å¹´ï¼Œæ‚£é«˜è¡€å‹æ¯”ä¾‹å¢åŠ 25%ï¼Œè€Œå¹´é¾„æ¯å¢åŠ ä¸€å²ï¼Œæ‚£é«˜è¡€å‹æ¯”ä¾‹ä¸ä¸€å®šæœ‰æ˜¾è‘—å˜åŒ–ï¼›\n\n1. ç®€åŒ–æ¨¡å‹ï¼Œå°†è‡ªå˜é‡ä¸å› å˜é‡é—´éçº¿æ€§çš„æ½œåœ¨çš„å…³ç³»ï¼Œè½¬åŒ–ä¸ºç®€å•çš„çº¿æ€§å…³ç³»ã€‚å½“ç„¶ï¼Œåˆ†ç®±ä¹Ÿå¯èƒ½å¸¦æ¥é—®é¢˜ï¼šç®€åŒ–çš„æ¨¡å‹å…³ç³»å¯èƒ½ä¸æ½œåœ¨çš„æ¨¡å‹å…³ç³»ä¸ä¸€è‡´ï¼ˆç”šè‡³å‘ç°çš„æ˜¯é”™è¯¯çš„æ¨¡å‹å…³ç³»ï¼‰ã€åˆ é™¤æ•°æ®ä¸­çš„ç»†å¾®å·®åˆ«ã€åˆ‡åˆ†ç‚¹å¯èƒ½æ²¡æœ‰å®é™…æ„ä¹‰ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# ç­‰å®½åˆ†ç®±\npop = po(\"histbin\", param_vals = list(breaks = 4))\npop$train(list(task))[[1]]$data()\n#>        Species       x1         x2       x3         x4\n#>   1:    setosa    (5,6]    (3,3.5] [-Inf,2] [-Inf,0.5]\n#>   2:    setosa [-Inf,5]    (2.5,3] [-Inf,2] [-Inf,0.5]\n#>   3:    setosa [-Inf,5]    (3,3.5] [-Inf,2] [-Inf,0.5]\n#>   4:    setosa [-Inf,5]    (3,3.5] [-Inf,2] [-Inf,0.5]\n#>   5:    setosa [-Inf,5]    (3.5,4] [-Inf,2] [-Inf,0.5]\n#>  ---                                                  \n#> 146: virginica    (6,7]    (2.5,3]    (4,6]   (2, Inf]\n#> 147: virginica    (6,7] [-Inf,2.5]    (4,6]    (1.5,2]\n#> 148: virginica    (6,7]    (2.5,3]    (4,6]    (1.5,2]\n#> 149: virginica    (6,7]    (3,3.5]    (4,6]   (2, Inf]\n#> 150: virginica    (5,6]    (2.5,3]    (4,6]    (1.5,2]\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# åˆ†ä½æ•°åˆ†ç®±\npop = po(\"quantilebin\", numsplits = 4)\npop$train(list(task))[[1]]$data()\n#>        Species         x1         x2         x3         x4\n#>   1:    setosa (-Inf,5.1] (3.3, Inf] (-Inf,1.6] (-Inf,0.3]\n#>   2:    setosa (-Inf,5.1]    (2.8,3] (-Inf,1.6] (-Inf,0.3]\n#>   3:    setosa (-Inf,5.1]    (3,3.3] (-Inf,1.6] (-Inf,0.3]\n#>   4:    setosa (-Inf,5.1]    (3,3.3] (-Inf,1.6] (-Inf,0.3]\n#>   5:    setosa (-Inf,5.1] (3.3, Inf] (-Inf,1.6] (-Inf,0.3]\n#>  ---                                                      \n#> 146: virginica (6.4, Inf]    (2.8,3] (5.1, Inf] (1.8, Inf]\n#> 147: virginica  (5.8,6.4] (-Inf,2.8] (4.35,5.1] (1.8, Inf]\n#> 148: virginica (6.4, Inf]    (2.8,3] (5.1, Inf] (1.8, Inf]\n#> 149: virginica  (5.8,6.4] (3.3, Inf] (5.1, Inf] (1.8, Inf]\n#> 150: virginica  (5.8,6.4]    (2.8,3] (4.35,5.1]  (1.3,1.8]\n```\n:::\n\n\n### ç‰¹å¾é™ç»´\n\næœ‰æ—¶æ•°æ®é›†å¯èƒ½åŒ…å«è¿‡å¤šç‰¹å¾ï¼Œç”šè‡³æ˜¯å†—ä½™ç‰¹å¾ï¼Œå¯ä»¥ç”¨é™ç»´æŠ€æœ¯è¿›å‹ç¼©ç‰¹å¾ï¼Œä½†é€šå¸¸ä¼šé™ä½æ¨¡å‹æ€§èƒ½ã€‚\n\n#### PCA\n\n$n$ ä¸ªç‰¹å¾ï¼Œè‹¥è½¬åŒ–ä¸º $n$ ä¸ªä¸»æˆåˆ†ï¼Œåˆ™ä¼šä¿ç•™åŸå§‹æ•°æ®çš„ 100% ä¿¡æ¯ï¼Œä½†è¿™å°±å¤±å»äº†é™ç»´çš„æ„ä¹‰ã€‚æ‰€ä»¥1ä¸€èˆ¬æ˜¯åªé€‰æ‹©å‰è‹¥å¹²ä¸ªä¸»æˆåˆ†ï¼Œä¸€èˆ¬åŸåˆ™æ˜¯é€‰æ‹©è‡³ä¿ç•™ 85% ä»¥ä¸Šä¿¡æ¯çš„ä¸»æˆåˆ†ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npop = po(\"pca\", rank. = 2)\npop$train(list(task))[[1]]$data()\n#>        Species       PC1         PC2\n#>   1:    setosa -2.684126 -0.31939725\n#>   2:    setosa -2.714142  0.17700123\n#>   3:    setosa -2.888991  0.14494943\n#>   4:    setosa -2.745343  0.31829898\n#>   5:    setosa -2.728717 -0.32675451\n#>  ---                                \n#> 146: virginica  1.944110 -0.18753230\n#> 147: virginica  1.527167  0.37531698\n#> 148: virginica  1.764346 -0.07885885\n#> 149: virginica  1.900942 -0.11662796\n#> 150: virginica  1.390189  0.28266094\n```\n:::\n\n\n#### æ ¸ PCA\n\nPCA é€‚ç”¨äºæ•°æ®çš„çº¿æ€§é™ç»´ã€‚è€Œæ ¸ä¸»æˆåˆ†åˆ†æï¼ˆKernel PCA, KPCAï¼‰å¯å®ç°æ•°æ®çš„éçº¿æ€§é™ç»´ï¼Œç”¨äºå¤„ç†çº¿æ€§ä¸å¯åˆ†çš„æ•°æ®é›†ã€‚\n\nKPCA çš„å¤§è‡´æ€è·¯æ˜¯ï¼šå¯¹äºè¾“å…¥ç©ºé—´ä¸­çš„çŸ©é˜µ $X$ï¼Œå…ˆç”¨ä¸€ä¸ªéçº¿æ€§æ˜ å°„æŠŠ $X$ ä¸­çš„æ‰€æœ‰æ ·æœ¬æ˜ å°„åˆ°ä¸€ä¸ªé«˜ç»´ç”šè‡³æ˜¯æ— ç©·ç»´çš„ç‰¹å¾ç©ºé—´ï¼ˆä½¿å…¶çº¿æ€§å¯åˆ†ï¼‰ï¼Œç„¶ååœ¨è¿™ä¸ªé«˜ç»´ç©ºé—´è¿›è¡Œ PCA é™ç»´ã€‚\n\n#### ICAï¼šç‹¬ç«‹æˆåˆ†åˆ†æ\n\nç‹¬ç«‹æˆåˆ†åˆ†æï¼Œæå–ç»Ÿè®¡æ„ä¹‰ä¸Šçš„ç‹¬ç«‹æˆåˆ†ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npop = po(\"ica\", n.comp = 3)\npop$train(list(task))[[1]]$data()\n#>        Species         V1         V2         V3\n#>   1:    setosa  0.1721410  0.4149772 -1.3952557\n#>   2:    setosa  0.2214486 -0.7872973 -1.3361069\n#>   3:    setosa -0.4563409 -0.3146524 -1.3308693\n#>   4:    setosa -0.6610660 -0.5861230 -1.2029337\n#>   5:    setosa -0.1833669  0.6446961 -1.3678177\n#>  ---                                           \n#> 146: virginica -0.1793776  0.7197010  0.9500885\n#> 147: virginica  0.1249361 -0.8278466  0.7937129\n#> 148: virginica -0.1614076  0.4371009  0.8769270\n#> 149: virginica -1.9147519  1.6044931  1.1871656\n#> 150: virginica -1.2683559  0.2261212  0.9094067\n```\n:::\n\n\n#### NMFï¼šéè´ŸçŸ©é˜µåˆ†è§£\n\nå¯¹äºä»»æ„ç»™å®šçš„éè´ŸçŸ©é˜µ $V$ï¼ŒNMF ç®—æ³•èƒ½å¤Ÿå¯»æ‰¾åˆ°éè´ŸçŸ©é˜µ $W$ å’Œéè´ŸçŸ©é˜µ $H$ï¼Œä½¿å®ƒä»¬çš„ç§¯ä¸ºçŸ©é˜µã€‚éè´ŸçŸ©é˜µåˆ†è§£çš„æ–¹æ³•åœ¨ä¿è¯çŸ©é˜µçš„éè´Ÿæ€§çš„åŒæ—¶èƒ½å¤Ÿå‡å°‘æ•°æ®é‡ï¼Œç›¸å½“äºæŠŠ $n$ ç»´çš„æ•°æ®é™ç»´åˆ° $r$ ç»´ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# BiocManager::install(\"Biobase\")\npop = po(\"nmf\", rank = 3)\npop$train(list(task))[[1]]$data()\n#> Registered S3 methods overwritten by 'registry':\n#>   method               from \n#>   print.registry_field proxy\n#>   print.registry_entry proxy\n#>        Species       NMF1      NMF2         NMF3\n#>   1:    setosa 0.08946447 0.4806157  0.039331051\n#>   2:    setosa 0.14847785 0.4012262 -0.003756253\n#>   3:    setosa 0.08482244 0.4394040  0.037395481\n#>   4:    setosa 0.10090716 0.4121730  0.052304626\n#>   5:    setosa 0.06054158 0.4968302  0.064062112\n#>  ---                                            \n#> 146: virginica 0.26134716 0.3282638  0.600819824\n#> 147: virginica 0.34676264 0.2323164  0.469663330\n#> 148: virginica 0.28374883 0.3073426  0.552988371\n#> 149: virginica 0.14504617 0.3818651  0.727874559\n#> 150: virginica 0.23580629 0.3002660  0.566502348\n```\n:::\n\n\n#### å‰”é™¤å¸¸é‡ç‰¹å¾\n\nä»ä»»åŠ¡ä¸­å‰”é™¤å¸¸é‡ç‰¹å¾ã€‚å¯¹äºæ¯ä¸ªç‰¹å¾ï¼Œè®¡ç®—ä¸åŒäºå…¶ä¼—æ•°å€¼çš„æ¯”ä¾‹ã€‚æ‰€æœ‰æ¯”ä¾‹ä½äºå¯è®¾ç½®é˜ˆå€¼çš„ç‰¹å¾éƒ½ä¼šä»ä»»åŠ¡ä¸­å‰”é™¤ã€‚ç¼ºå¤±å€¼å¯ä»¥è¢«å¿½ç•¥ï¼Œä¹Ÿå¯ä»¥è§†ä¸ºä¸éç¼ºå¤±å€¼ä¸åŒçš„å¸¸è§„å€¼ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata = data.table(y = runif(10), a = 1:10, b = rep(1, 10), \n                  c = rep(1:2, each = 5))\ntask_ex = as_task_regr(data, target = \"y\")\npo = po(\"removeconstants\")  # å‰”é™¤å¸¸é‡ç‰¹å¾ b\npo$train(list(task_ex))[[1]]$data()\n#>               y  a c\n#>  1: 0.891268901  1 1\n#>  2: 0.002797802  2 1\n#>  3: 0.649207745  3 1\n#>  4: 0.561067845  4 1\n#>  5: 0.427392408  5 1\n#>  6: 0.387362043  6 2\n#>  7: 0.544585730  7 2\n#>  8: 0.622006226  8 2\n#>  9: 0.183312478  9 2\n#> 10: 0.342760530 10 2\n```\n:::\n\n\n### åˆ†ç±»ç‰¹å¾\n\n#### å› å­æŠ˜å \n\nç®¡é“è¿ç®—â€œcollapsefactorsâ€ï¼Œå¯¹å› å­æˆ–æœ‰åºå› å­è¿›è¡ŒæŠ˜å ï¼ŒæŠ˜å è®­ç»ƒæ ·æœ¬ä¸­æœ€å°‘çš„æ°´å¹³ï¼Œç›´åˆ°å‰©ä¸‹ `target_level_count` ä¸ªæ°´å¹³ã€‚ç„¶è€Œï¼Œé‚£äº›å‡ºç°ç‡é«˜äº `no_collapse_above_prevalence` çš„æ°´å¹³ä¼šè¢«ä¿ç•™ã€‚å¯¹äºå› å­å˜é‡ï¼Œå®ƒä»¬è¢«æŠ˜å åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ°´å¹³ï¼Œå¯¹äºæœ‰åºå˜é‡ï¼Œç¨€æœ‰å˜é‡è¢«æŠ˜å åˆ°ç›¸é‚»çš„ç±»åˆ«ï¼Œä»¥æ ·æœ¬æ•°è¾ƒå°‘è€…ä¸ºå‡†ã€‚\n\nè®­ç»ƒé›†ä¸­æ²¡æœ‰å‡ºç°çš„æ°´å¹³åœ¨é¢„æµ‹é›†ä¸­ä¸ä¼šè¢«ä½¿ç”¨ï¼Œå› æ­¤ç»å¸¸ä¸å› å­ä¿®æ­£ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndat = tibble(color = factor(starwars$skin_color), y = 1)\ndat %>% count(color)\n#> # A tibble: 31 Ã— 2\n#>    color                   n\n#>    <fct>               <int>\n#>  1 blue                    2\n#>  2 blue, grey              2\n#>  3 brown                   4\n#>  4 brown mottle            1\n#>  5 brown, white            1\n#>  6 dark                    6\n#>  7 fair                   17\n#>  8 fair, green, yellow     1\n#>  9 gold                    1\n#> 10 green                   6\n#> # â„¹ 21 more rows\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = as_task_regr(dat, target = \"y\")\npoc = po(\"collapsefactors\", target_level_count = 5)\npoc$train(list(task))[[1]]$data() %>% count(color)\n#>    color  n\n#> 1:  dark  6\n#> 2:  fair 17\n#> 3: green  6\n#> 4:  grey 47\n#> 5: light 11\n```\n:::\n\n\n#### å› å­ä¿®æ­£\n\nç®¡é“è¿ç®—â€œfixfactorsâ€ï¼ˆå‚æ•°ï¼š`droplevels = TRUE`ï¼‰ç¡®ä¿é¢„æµ‹è¿‡ç¨‹ä¸­çš„å› å­æ°´å¹³ä¸è®­ç»ƒè¿‡ç¨‹ä¸­çš„ç›¸åŒï¼›å¯èƒ½ä¼šåœ¨ä¹‹å‰ä¸¢å¼ƒç©ºçš„è®­ç»ƒå› å­æ°´å¹³ã€‚\n\næ³¨æ„ï¼Œå¦‚æœå‘ç°æœªè§è¿‡çš„å› å­æ°´å¹³ï¼Œè¿™å¯èƒ½ä¼šåœ¨é¢„æµ‹æœŸé—´å¼•å…¥ç¼ºå¤±å€¼ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndattrain = data.table(\n  a = factor(c(\"a\", \"b\", \"c\", NA), levels = letters),\n  b = ordered(c(\"a\", \"b\", \"c\", NA)),\n  target = 1:4\n)\ndattrain\n#>       a    b target\n#> 1:    a    a      1\n#> 2:    b    b      2\n#> 3:    c    c      3\n#> 4: <NA> <NA>      4\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndattest = data.table(\n  a = factor(c(\"a\", \"b\", \"c\", \"d\"), levels = letters[10:1]),\n  b = ordered(c(\"a\", \"b\", \"c\", \"d\")),\n  target = 1:4\n)\ndattest\n#>    a b target\n#> 1: a a      1\n#> 2: b b      2\n#> 3: c c      3\n#> 4: d d      4\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask_train = as_task_regr(dattrain, \"target\")\ntask_test = as_task_regr(dattest, \"target\")\npo = po(\"fixfactors\")\npo$train(list(task_train))\n#> $output\n#> <TaskRegr:dattrain> (4 x 3)\n#> * Target: target\n#> * Properties: -\n#> * Features (2):\n#>   - fct (1): a\n#>   - ord (1): b\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npo$predict(list(task_test))[[1]]$data()\n#>    target    a    b\n#> 1:      1    a    a\n#> 2:      2    b    b\n#> 3:      3    c    c\n#> 4:      4 <NA> <NA>\n```\n:::\n\n\n#### å› å­ç¼–ç \n\nå¯¹å› å­ã€æœ‰åºå› å­ã€å­—ç¬¦ç‰¹å¾è¿›è¡Œç¼–ç ã€‚å‚æ•° `method` æŒ‡å®šç¼–ç æ–¹æ³•ï¼š\n\n- â€œone-hotâ€ï¼šç‹¬çƒ­ç¼–ç ï¼›\n\n- â€œtreatmentâ€ï¼šè™šæ‹Ÿç¼–ç ï¼Œåˆ›å»º $n-1$ åˆ—ï¼Œç•™å‡ºæ¯ä¸ªå› å­å˜é‡çš„ç¬¬ä¸€ä¸ªå› å­æ°´å¹³ï¼ˆè§`stats::conc.treatment()`ï¼‰ï¼›\n\n- â€œhelmertâ€ï¼šæ ¹æ® Helmert å¯¹æ¯”åº¦åˆ›å»ºåˆ—ï¼ˆè§`stats::conc.helmert()`ï¼‰ï¼›\n\n- â€œpolyâ€ï¼šæ ¹æ®æ­£äº¤å¤šé¡¹å¼åˆ›å»ºå¯¹æ¯”åˆ—ï¼ˆè§`stats::conc.poly()`ï¼‰ï¼›\n\n- â€œsumâ€ï¼šåˆ›å»ºå¯¹æ¯”åº¦ç›¸åŠ ä¸ºé›¶çš„åˆ—ï¼Œï¼ˆè§`stats::conc.sum()`ï¼‰\n\næ–°åˆ›å»ºçš„åˆ—æŒ‰æ¨¡å¼ `[column-name].[x]` å‘½åï¼Œå…¶ä¸­ `x` æ˜¯ â€one-hotâ€ å’Œ â€treatmentâ€ ç¼–ç çš„å„è‡ªå› å­æ°´å¹³ï¼Œå¦åˆ™æ˜¯ä¸€ä¸ªæ•´æ•°åºåˆ—ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"penguins\")\npoe = po(\"encode\", method = \"one-hot\")   # ç‹¬çƒ­ç¼–ç \npoe$train(list(task))[[1]]$data()[, 7:11]\n#>      island.Biscoe island.Dream island.Torgersen sex.female sex.male\n#>   1:             0            0                1          0        1\n#>   2:             0            0                1          1        0\n#>   3:             0            0                1          1        0\n#>   4:             0            0                1         NA       NA\n#>   5:             0            0                1          1        0\n#>  ---                                                                \n#> 340:             0            1                0          0        1\n#> 341:             0            1                0          1        0\n#> 342:             0            1                0          0        1\n#> 343:             0            1                0          0        1\n#> 344:             0            1                0          1        0\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npoe = po(\"encode\", method = \"treatment\")  # è™šæ‹Ÿç¼–ç \npoe$train(list(task))[[1]]$data()[, 7:9]\n#>      island.Dream island.Torgersen sex.male\n#>   1:            0                1        1\n#>   2:            0                1        0\n#>   3:            0                1        0\n#>   4:            0                1       NA\n#>   5:            0                1        0\n#>  ---                                       \n#> 340:            1                0        1\n#> 341:            1                0        0\n#> 342:            1                0        1\n#> 343:            1                0        1\n#> 344:            1                0        0\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npoe = po(\"encode\", method = \"helmert\")  # Helmert ç¼–ç \npoe$train(list(task))[[1]]$data()[, 7:9]\n#>      island.1 island.2 sex.1\n#>   1:        0        2     1\n#>   2:        0        2    -1\n#>   3:        0        2    -1\n#>   4:        0        2    NA\n#>   5:        0        2    -1\n#>  ---                        \n#> 340:        1       -1     1\n#> 341:        1       -1    -1\n#> 342:        1       -1     1\n#> 343:        1       -1     1\n#> 344:        1       -1    -1\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npoe = po(\"encode\", method = \"poly\")  # å¤šé¡¹ç¼–ç \npoe$train(list(task))[[1]]$data()[, 7:9]\n#>           island.1   island.2      sex.1\n#>   1:  7.071068e-01  0.4082483  0.7071068\n#>   2:  7.071068e-01  0.4082483 -0.7071068\n#>   3:  7.071068e-01  0.4082483 -0.7071068\n#>   4:  7.071068e-01  0.4082483         NA\n#>   5:  7.071068e-01  0.4082483 -0.7071068\n#>  ---                                    \n#> 340: -7.850462e-17 -0.8164966  0.7071068\n#> 341: -7.850462e-17 -0.8164966 -0.7071068\n#> 342: -7.850462e-17 -0.8164966  0.7071068\n#> 343: -7.850462e-17 -0.8164966  0.7071068\n#> 344: -7.850462e-17 -0.8164966 -0.7071068\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npoe = po(\"encode\", method = \"sum\")  # sum ç¼–ç \npoe$train(list(task))[[1]]$data()[, 7:9]\n#>      island.1 island.2 sex.1\n#>   1:       -1       -1    -1\n#>   2:       -1       -1     1\n#>   3:       -1       -1     1\n#>   4:       -1       -1    NA\n#>   5:       -1       -1     1\n#>  ---                        \n#> 340:        0        1    -1\n#> 341:        0        1     1\n#> 342:        0        1    -1\n#> 343:        0        1    -1\n#> 344:        0        1     1\n```\n:::\n\n\n::: {.callout-warning}\nä»¥ä¸‹å†…å®¹æš‚ç¼“ï¼š\n\n- æ•ˆåº”ç¼–ç \n\n- æ—¥æœŸæ—¶é—´ç‰¹å¾\n\n- æ–‡æœ¬ç‰¹å¾\n:::\n\n### å¤„ç†ä¸å‡è¡¡æ•°æ®\n\né€šè¿‡é‡‡æ ·å¯¹ä»»åŠ¡è¿›è¡Œç±»å¹³è¡¡ï¼Œå¯èƒ½æœ‰åˆ©äºå¯¹ä¸å¹³è¡¡çš„è®­ç»ƒæ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œé‡‡æ ·åªå‘ç”Ÿåœ¨è®­ç»ƒé˜¶æ®µã€‚\n\n#### æ¬ é‡‡æ ·ä¸è¿‡é‡‡æ ·\n\næ¬ é‡‡æ ·ï¼šåªä¿ç•™å¤šæ•°ç±»çš„ä¸€éƒ¨åˆ†è¡Œï¼›è¿‡é‡‡æ ·ï¼šå¯¹å°‘æ•°ç±»è¿›è¡Œè¶…é‡é‡‡æ ·ï¼ˆé‡å¤æ•°æ®ç‚¹ï¼‰ã€‚\n\nPipeOp åå­—ä¸º â€classbalancingâ€ï¼Œå‚æ•°ï¼š\n\n- ratioï¼šç›¸å¯¹äº `$reference` å€¼ï¼Œè¦ä¿ç•™çš„ç±»çš„è¡Œæ•°çš„æ¯”ç‡ï¼Œé»˜è®¤ä¸º 1ï¼›\n\n- referenceï¼š`$ratio` çš„å€¼æ˜¯æ ¹æ®ä»€ä¹ˆæ¥è¡¡é‡çš„ã€‚å¯ä»¥æ˜¯ â€œallâ€ï¼ˆé»˜è®¤å€¼ï¼Œæ‰€æœ‰ç±»çš„å¹³å‡å®ä¾‹æ•°ï¼‰ï¼Œâ€œmajorâ€ï¼ˆæ‹¥æœ‰æœ€å¤šå®ä¾‹çš„ç±»çš„å®ä¾‹æ•°ï¼‰ï¼Œâ€œminorâ€ï¼ˆæ‹¥æœ‰æœ€å°‘å®ä¾‹çš„ç±»çš„å®ä¾‹æ•°ï¼‰ï¼Œâ€œnonmajorâ€ï¼ˆé™¤ä¸»è¦ç±»å¤–æ‰€æœ‰ç±»çš„å¹³å‡å®ä¾‹æ•°ï¼‰ï¼Œâ€œnonminorâ€ï¼ˆé™¤æ¬¡è¦ç±»å¤–æ‰€æœ‰ç±»çš„å¹³å‡å®ä¾‹æ•°ï¼‰ï¼Œä»¥åŠ â€œoneâ€ï¼ˆ`$ratio` å†³å®šæ¯ä¸ªç±»çš„å®ä¾‹æ•°ï¼‰ï¼›\n\n- adjustï¼šå“ªäº›ç±»è¦å‘ä¸Š/å‘ä¸‹é‡‡æ ·ã€‚å¯ä»¥æ˜¯ â€œallâ€ï¼ˆé»˜è®¤ï¼‰ã€â€œmajorâ€ã€â€œminorâ€ã€â€œnonmajorâ€ã€â€œnonminorâ€ã€â€œupsampleâ€ï¼ˆåªè¿‡é‡‡æ ·ï¼‰å’Œâ€œdownsampleâ€ï¼ˆåªæ¬ é‡‡æ ·ï¼‰ï¼›\n\n- shuffleï¼šæ˜¯å¦å¯¹ç»“æœä»»åŠ¡çš„è¡Œè¿›è¡Œæ´—ç‰Œï¼Œé»˜è®¤ä¸º `TRUE`ã€‚å¦‚æœæ•°æ®è¢«è¿‡é‡‡æ ·ä¸” `shuffle = FALSE`ï¼Œç»“æœä»»åŠ¡å°†ä»¥åŸå§‹é¡ºåºæ˜¾ç¤ºåŸå§‹è¡Œï¼ˆåœ¨æ¬ é‡‡æ ·ä¸­ä¸è¢«ç§»é™¤ï¼‰ï¼Œç„¶åæ˜¯æ‰€æœ‰æ–°æ·»åŠ çš„è¡Œï¼ŒæŒ‰ç›®æ ‡ç±»åˆ«æ’åºã€‚\n\nè¿‡/æ¬ é‡‡æ ·çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n- é¦–å…ˆï¼Œè®¡ç®—â€ ç›®æ ‡ç±»è®¡æ•°â€ï¼Œæ–¹æ³•æ˜¯å– `reference` å‚æ•°æ‰€æŒ‡ç¤ºçš„æ‰€æœ‰ç±»çš„å¹³å‡æ•°ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœ reference å‚æ•°æ˜¯ â€nonmajorâ€ï¼šæ‰€æœ‰ä¸æ˜¯ â€œmajorâ€ ç±»çš„ç±»çš„å¹³å‡æ•°ï¼Œå³æ‹¥æœ‰æœ€å¤šæ ·æœ¬çš„ç±»ï¼‰ï¼Œç„¶åå°†å…¶ä¸æ¯”ç‡å‚æ•°çš„å€¼ç›¸ä¹˜ã€‚å¦‚æœ reference æ˜¯ â€oneâ€ï¼Œé‚£ä¹ˆâ€œç›®æ ‡ç±»è®¡æ•°â€ å°±æ˜¯æ¯”ç‡çš„å€¼ï¼ˆå³ 1 * æ¯”ç‡ï¼‰ã€‚\n\n- ç„¶åï¼Œå¯¹äºæ¯ä¸ªè¢« `adjust` å‚æ•°å¼•ç”¨çš„ç±»ï¼ˆä¾‹å¦‚ï¼Œè‹¥è°ƒæ•´æ˜¯â€œnonminorâ€ï¼šæ¯ä¸ªä¸æ˜¯æ ·æœ¬æœ€å°‘çš„ç±»ï¼‰ï¼ŒPipeOpClassBalancing è¦ä¹ˆæŠ›å‡ºæ ·æœ¬ï¼ˆæ¬ é‡‡æ ·ï¼‰ï¼Œè¦ä¹ˆå¢åŠ ä¸éšæœºé€‰æ‹©çš„æ ·æœ¬ç›¸ç­‰çš„é¢å¤–è¡Œï¼ˆè¿‡é‡‡æ ·ï¼‰ï¼Œç›´åˆ°è¿™äº›ç±»çš„æ ·æœ¬æ•°ç­‰äºâ€œç›®æ ‡ç±»è®¡æ•°â€ã€‚\n\n- ä½¿ç”¨ `task$filter()` æ¥åˆ é™¤è¡Œã€‚å½“åœ¨è¿‡é‡‡æ ·è¿‡ç¨‹ä¸­æ·»åŠ ç›¸åŒçš„è¡Œæ—¶ï¼Œé‚£ä¹ˆç”±äº[æ··æ·†]ï¼Œä¸èƒ½ä½¿ç”¨ `task$row_roles$use` æ¥å¤åˆ¶è¡Œï¼›è€Œæ˜¯ä½¿ç”¨ `task$rbind()` å‡½æ•°ï¼Œå¹¶é™„åŠ ä¸€ä¸ªæ–°çš„ data.tableï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰è¢«å¤åˆ¶çš„è¡Œï¼Œå…¶æ¬¡æ•°æ­£å¥½ä¸è¢«æ·»åŠ çš„è¡Œç›¸åŒã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"german_credit\")\ntable(task$truth())\n#> \n#> good  bad \n#>  700  300\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n## æ¬ é‡‡æ ·\nopb_down = po(\"classbalancing\", reference = \"minor\", adjust = \"major\")\n# é»˜è®¤ratio = 1, è‹¥ratio = 2, ç»“æœæ˜¯600 good, 300 bad\nresult = opb_down$train(list(task))[[1]]\ntable(result$truth())\n#> \n#> good  bad \n#>  300  300\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n## è¿‡é‡‡æ ·\nopb_up = po(\"classbalancing\", reference = \"major\", adjust = \"minor\")\n# é»˜è®¤ratio = 1, è‹¥ratio = 2, ç»“æœæ˜¯700 good, 1400 bad\nresult = opb_up$train(list(task))[[1]]\ntable(result$truth())\n#> \n#> good  bad \n#>  700  700\n```\n:::\n\n\n#### SMOTE æ³•\n\nç”¨ SMOTE ç®—æ³•åˆ›å»ºå°‘æ•°ç±»åˆ«çš„åˆæˆè§‚æµ‹ï¼Œç”Ÿæˆä¸€ä¸ªæ›´å¹³è¡¡çš„æ•°æ®é›†ã€‚è¯¥ç®—æ³•ä¸ºæ¯ä¸ªå°‘æ•°ç±»è§‚æµ‹å–æ ·ï¼ŒåŸºäºè¯¥è§‚æµ‹çš„ $K$ ä¸ªæœ€è¿‘é‚»å±…ç”Ÿæˆæ–°è§‚æµ‹ã€‚å®ƒåªèƒ½åº”ç”¨äºå…·æœ‰çº¯æ•°å€¼ç‰¹å¾çš„ä»»åŠ¡ã€‚è¯¦è§ `smotefamily::SMOTE`ã€‚\n\nPipeOp åå­—ï¼šâ€œsmoteâ€ï¼Œå…¶å‚æ•°ï¼ˆå…·ä½“å‚é˜… `SMOTE()`ï¼‰ï¼š\n\n- Kï¼šç”¨äºæŠ½å–æ–°å€¼çš„è¿‘é‚»çš„æ•°é‡ï¼›\n\n- dup_sizeï¼šåˆæˆçš„å°‘æ•°å®ä¾‹åœ¨åŸå§‹å¤šæ•°å®ä¾‹æ•°é‡ä¸Šçš„æœŸæœ›æ¬¡æ•°ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# åªæ”¯æŒdouble å‹ç‰¹å¾, éœ€å®‰è£… smotefamily åŒ…\npop = po(\"colapply\", applicator = as.numeric,\n         affect_columns = selector_type(\"integer\")) %>>%\n  po(\"encodeimpact\") %>>%\n  po(\"smote\", K = 5, dup_size = 1)  # å°‘æ•°ç±»å¢åŠ  1 å€\nresult = pop$train(task)[[1]]\ntable(result$truth())\n#> \n#> good  bad \n#>  700  600\n```\n:::\n\n\n### ç›®æ ‡å˜æ¢\n\nä¸ºäº†æé«˜é¢„æµ‹èƒ½åŠ›ï¼Œå¯¹äºå¼‚æ–¹å·®æˆ–å³åçš„å› å˜é‡æ•°æ®ï¼Œç»å¸¸éœ€è¦åšå–å¯¹æ•°å˜æ¢ã€æˆ– Box-Cox å˜æ¢ï¼Œä»¥å˜æˆæ­£æ€æ•°æ®ï¼Œå†è¿›è¡Œå›å½’å»ºæ¨¡ï¼Œé¢„æµ‹å€¼è¦å›åˆ°åŸæ•°æ®é‡çº§ï¼Œè¿˜è¦åšé€†å˜æ¢ã€‚\n\nmlr3pipelines åŒ…è¿˜æä¾›äº†ç›®æ ‡å˜æ¢ç®¡é“ï¼Œå°†ç›®æ ‡å˜æ¢åŠå…¶é€†å˜æ¢ï¼Œéƒ½å°è£…åˆ°å›¾å­¦ä¹ å™¨ï¼Œè¿™æ ·å°±çœäº†æ‰‹åŠ¨åšä¸¤æ¬¡å˜æ¢ï¼Œè¿˜èƒ½æ•´ä½“è¿›è¡Œè°ƒå‚æˆ–åŸºå‡†æµ‹è¯•ã€‚\n\nå¯¹äºæ–¹å·®é€æ¸å˜å¤§çš„å¼‚æ–¹å·®çš„æ—¶é—´åºåˆ—æ•°æ®ï¼Œæˆ–å³ååˆ†å¸ƒçš„æ•°æ®ï¼Œå¯ä»¥å°è¯•åšå¯¹æ•°å˜æ¢æˆ–å¼€å¹³æ–¹å˜æ¢ï¼Œä»¥ç¨³å®šæ–¹å·®å’Œå˜æˆæ­£æ€åˆ†å¸ƒã€‚\n\nå¯¹æ•°å˜æ¢ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå…·æœ‰å¯è§£é‡Šæ€§ï¼š**å¯¹æ•°å€¼çš„å˜åŒ–æ˜¯åŸå§‹å°ºåº¦ä¸Šçš„ç›¸å¯¹ï¼ˆç™¾åˆ†æ¯”ï¼‰å˜åŒ–**ã€‚è‹¥ä½¿ç”¨ä»¥ 10 ä¸ºåº•çš„å¯¹æ•°ï¼Œåˆ™å¯¹æ•°åˆ»åº¦ä¸Šæ¯å¢åŠ  1 å¯¹åº”åŸå§‹åˆ»åº¦ä¸Šçš„ä¹˜ä»¥ 10ã€‚\n\næ³¨æ„ï¼ŒåŸå§‹æ•°æ®è‹¥å­˜åœ¨é›¶æˆ–è´Ÿï¼Œåˆ™ä¸èƒ½å–å¯¹æ•°æˆ–å¼€æ ¹å·ï¼Œè§£å†³åŠæ³•æ˜¯åšå¹³ç§»ï¼š$a = \\max \\{ 0, -\\min \\{x_i\\} + \\varepsilon \\}$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"mtcars\")\nlearner = lrn(\"regr.lm\")\ng_ppl = ppl(\"targettrafo\", graph = learner)\ng_ppl$param_set$values$targetmutate.trafo = function(x) log(x)\ng_ppl$param_set$values$targetmutate.inverter = function(x) list(response = exp(x$response))\ng_ppl$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-132-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngl = as_learner(g_ppl)\ngl$train(task)\ngl$predict(task)\n#> <PredictionRegr> for 32 observations:\n#>     row_ids truth response\n#>           1  21.0 21.67976\n#>           2  21.0 21.10831\n#>           3  22.8 25.73690\n#> ---                       \n#>          30  19.7 19.58533\n#>          31  15.0 14.11015\n#>          32  21.4 23.11105\n```\n:::\n\n\n# åµŒå¥—é‡æŠ½æ ·\n\næ„å»ºæ¨¡å‹ï¼Œæ˜¯å¦‚ä½•ä»ä¸€ç»„æ½œåœ¨çš„å€™é€‰æ¨¡å‹ï¼ˆå¦‚ä¸åŒçš„ç®—æ³•ï¼Œä¸åŒçš„è¶…å‚æ•°ï¼Œä¸åŒçš„ç‰¹å¾å­é›†ï¼‰ä¸­é€‰æ‹©æœ€ä½³æ¨¡å‹ã€‚åœ¨æ„å»ºæ¨¡å‹è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„é‡æŠ½æ ·åˆ’åˆ†ï¼Œä¸åº”è¯¥åŸæ ·ç”¨æ¥è¯„ä¼°æœ€ç»ˆé€‰æ‹©æ¨¡å‹çš„æ€§èƒ½ã€‚\n\né€šè¿‡åœ¨ç›¸åŒçš„æµ‹è¯•é›†æˆ–ç›¸åŒçš„ CV åˆ’åˆ†ä¸Šåå¤è¯„ä¼°å­¦ä¹ å™¨ï¼Œæµ‹è¯•é›†çš„ä¿¡æ¯ä¼šâ€œæ³„éœ²â€åˆ°è¯„ä¼°ä¸­ï¼Œå¯¼è‡´æœ€ç»ˆçš„æ€§èƒ½ä¼°è®¡åäºä¹è§‚ã€‚\n\næ¨¡å‹æ„å»ºçš„æ‰€æœ‰éƒ¨åˆ†ï¼ˆåŒ…æ‹¬æ¨¡å‹é€‰æ‹©ã€é¢„å¤„ç†ï¼‰éƒ½åº”è¯¥çº³å…¥åˆ°è®­ç»ƒæ•°æ®çš„æ¨¡å‹å¯»æ‰¾è¿‡ç¨‹ä¸­ã€‚æµ‹è¯•é›†åº”è¯¥åªä½¿ç”¨ä¸€æ¬¡ï¼Œæµ‹è¯•é›†åªæœ‰åœ¨æ¨¡å‹å®Œå…¨è®­ç»ƒå¥½ä¹‹åæ‰èƒ½è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚å·²ç¡®å®šå¥½äº†è¶…å‚æ•°ã€‚è¿™æ ·ä»æµ‹è¯•é›†è·å¾—çš„æ€§èƒ½æ‰æ˜¯çœŸå®æ€§èƒ½çš„æ— åä¼°è®¡ã€‚\n\nå¯¹äºæœ¬èº«éœ€è¦é‡æŠ½æ ·çš„æ­¥éª¤ï¼ˆå¦‚è¶…å‚æ•°è°ƒå‚ï¼‰ï¼Œè¿™éœ€è¦ä¸¤ä¸ªåµŒå¥—çš„é‡æŠ½æ ·å¾ªç¯ï¼Œå³å†…å±‚è°ƒå‚å’Œå¤–å±‚è¯„ä¼°éƒ½éœ€è¦é‡æŠ½æ ·ç­–ç•¥ã€‚\n\nä¸‹é¢ä»å®ä¾‹æ¥çœ‹ï¼š\n\n1. ä½¿ç”¨3 æŠ˜äº¤å‰éªŒè¯æ¥è·å¾—ä¸åŒçš„éæµ‹è¯•é›†å’Œæµ‹è¯•é›†ï¼ˆå¤–å±‚é‡æŠ½æ ·ï¼‰\n\n2. åœ¨éæµ‹è¯•é›†ä¸Šä½¿ç”¨ 4 æŠ˜äº¤å‰éªŒè¯æ¥è·å¾—ä¸åŒçš„å†…å±‚è®­ç»ƒé›†å’Œå†…å±‚æµ‹è¯•é›†ï¼ˆå†…å±‚é‡æŠ½æ ·ï¼‰\n\n3. ä½¿ç”¨å†…å±‚æ•°æ®åˆ’åˆ†æ¥åšè¶…å‚æ•°è°ƒå‚\n\n4. ä½¿ç”¨ç»è¿‡å†…å±‚é‡æŠ½æ ·è°ƒå‚çš„æœ€ä¼˜è¶…å‚æ•°åœ¨å¤–å±‚éæµ‹è¯•é›†ä¸Šæ‹Ÿåˆå­¦ä¹ å™¨\n\n5. è¯„ä¼°å­¦ä¹ å™¨åœ¨å¤–å±‚æµ‹è¯•é›†ä¸Šçš„æ€§èƒ½\n\n6. å¯¹å¤–å±‚é‡æŠ½æ ·çš„ä¸‰æŠ˜ä¸­çš„æ¯ä¸€æŠ˜é‡å¤æ‰§è¡Œ 2 - 5\n\n7. ä¸‰ä¸ªæ€§èƒ½å€¼è¢«æ±‡æ€»ä¸ºä¸€ä¸ªæ— åçš„æ€§èƒ½ä¼°è®¡\n\nè¿‡ç¨‹çœ‹èµ·æ¥å¤æ‚ï¼Œå®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦å°†å†…å±‚é‡æŠ½æ ·æ”¾åœ¨è‡ªåŠ¨è°ƒå‚å™¨ï¼Œå¤–å±‚é‡æŠ½æ ·æ”¾åœ¨ `resample()` ä¸­ï¼Œå…¶ä¸­çš„å­¦ä¹ å™¨æ¢æˆè‡ªåŠ¨è°ƒå‚å™¨ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# å†…å±‚é‡æŠ½æ ·ï¼ˆè¶…å‚æ•°è°ƒå‚ï¼‰\nat = auto_tuner(\n  tuner = tnr(\"grid_search\", resolution = 10),\n  learner = lrn(\"classif.rpart\", cp = to_tune(lower = .001, upper = .1)),\n  resampling = rsmp(\"cv\", folds = 4),\n  measure = msr(\"classif.acc\"),\n  term_evals = 5\n)\n\n# å¤–å±‚é‡æŠ½æ ·\ntask = tsk(\"pima\")\nouter_resampling = rsmp(\"cv\", folds = 3)\nrr = resample(task, at, outer_resampling, store_models = TRUE)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# æå–å†…å±‚é‡æŠ½æ ·ç»“æœï¼ŒæŸ¥çœ‹æœ€ä¼˜çš„è¶…å‚æ•°\nextract_inner_tuning_results(rr)\n#>    iteration    cp classif.acc learner_param_vals  x_domain task_id\n#> 1:         1 0.067   0.7480469          <list[2]> <list[1]>    pima\n#> 2:         2 0.012   0.7578125          <list[2]> <list[1]>    pima\n#> 3:         3 0.012   0.7343750          <list[2]> <list[1]>    pima\n#>             learner_id resampling_id\n#> 1: classif.rpart.tuned            cv\n#> 2: classif.rpart.tuned            cv\n#> 3: classif.rpart.tuned            cv\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# æŸ¥çœ‹å¤–å±‚é‡æŠ½æ ·çš„æ¯æ¬¡ç»“æœ\nrr$score()\n#>    task_id          learner_id resampling_id iteration classif.ce\n#> 1:    pima classif.rpart.tuned            cv         1  0.2968750\n#> 2:    pima classif.rpart.tuned            cv         2  0.2695312\n#> 3:    pima classif.rpart.tuned            cv         3  0.2578125\n#> Hidden columns: task, learner, resampling, prediction\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# æŸ¥çœ‹å¤–å±‚é‡æŠ½æ ·çš„å¹³å‡æ¨¡å‹æ€§èƒ½\nrr$aggregate()\n#> classif.ce \n#>  0.2747396\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# ç”¨å…¨éƒ¨æ•°æ®è‡ªåŠ¨è°ƒå‚ï¼Œé¢„æµ‹æ–°æ•°æ®\nat$train(task)\ndat = task$data()[1:5, -1]\nat$predict_newdata(dat)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# è‹¥æ”¹ç”¨tune_nested() å‡½æ•°ï¼ŒåµŒå¥—é‡æŠ½æ ·è¿‡ç¨‹è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–\nrr = tune_nested(\n  tuner = tnr(\"grid_search\", resolution = 10),\n  task = task,\n  learner = lrn(\"classif.rpart\", cp = to_tune(lower = .001, upper = .1)),\n  inner_resampling = rsmp(\"cv\", folds = 4),\n  outer_resampling = rsmp(\"cv\", folds = 3),\n  measure = msr(\"classif.acc\"),\n  term_evals = 5\n)\n```\n:::\n\n\n# è¶…å‚æ•°è°ƒå‚\n\næœºå™¨å­¦ä¹ çš„æ¨¡å‹å‚æ•°æ˜¯æ¨¡å‹çš„ä¸€é˜¶ï¼ˆç›´æ¥ï¼‰å‚æ•°ï¼Œæ˜¯è®­ç»ƒæ¨¡å‹æ—¶ç”¨æ¢¯åº¦ä¸‹é™æ³•å¯»ä¼˜çš„å‚æ•°ï¼Œæ¯”å¦‚æ­£åˆ™åŒ–å›å½’æ¨¡å‹çš„å›å½’ç³»æ•°ï¼›è€Œè¶…å‚æ•°æ˜¯æ¨¡å‹çš„äºŒé˜¶å‚æ•°ï¼Œéœ€è¦äº‹å…ˆè®¾å®šä¸ºæŸå€¼ï¼Œæ‰èƒ½å¼€å§‹è®­ç»ƒä¸€é˜¶æ¨¡å‹å‚æ•°ï¼Œæ¯”å¦‚æ­£åˆ™åŒ–å›å½’æ¨¡å‹çš„æƒ©ç½šå‚æ•°ã€KNN çš„é‚»å±…æ•°ç­‰ã€‚\n\nè¶…å‚æ•°ä¼šå¯¹æ‰€è®­ç»ƒæ¨¡å‹çš„æ€§èƒ½äº§ç”Ÿé‡å¤§å½±å“ï¼Œæ‰€ä»¥ä¸èƒ½æ˜¯éšä¾¿æˆ–å‡­ç»éªŒéšä¾¿æŒ‡å®šï¼Œè€Œæ˜¯éœ€è¦è®¾å®šå¾ˆå¤šç§å¤‡é€‰é…ç½®ï¼Œä»ä¸­é€‰å‡ºè®©æ¨¡å‹æ€§èƒ½æœ€ä¼˜çš„è¶…å‚æ•°é…ç½®ï¼Œè¿™å°±æ˜¯**è¶…å‚æ•°è°ƒå‚**ã€‚\n\nè¶…å‚æ•°è°ƒå‚æ˜¯ç”¨ mlr3tuning åŒ…å®ç°ï¼Œæ˜¯ä¸€é¡¹å¤šæ–¹è”åŠ¨çš„ç³»ç»Ÿå·¥ä½œï¼Œéœ€è¦è®¾å®šï¼šæœç´¢ç©ºé—´ã€å­¦ä¹ å™¨ã€ä»»åŠ¡ã€é‡æŠ½æ ·ç­–ç•¥ã€æ¨¡å‹æ€§èƒ½åº¦é‡æŒ‡æ ‡ã€ç»ˆæ­¢æ¡ä»¶ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlearner = lrn(\"classif.svm\")\nlearner$param_set  # æŸ¥çœ‹å­¦ä¹ å™¨çš„è¶…å‚æ•°\n#> <ParamSet>\n#>                id    class lower upper nlevels          default parents value\n#>  1:     cachesize ParamDbl  -Inf   Inf     Inf               40              \n#>  2: class.weights ParamUty    NA    NA     Inf                               \n#>  3:         coef0 ParamDbl  -Inf   Inf     Inf                0  kernel      \n#>  4:          cost ParamDbl     0   Inf     Inf                1    type      \n#>  5:         cross ParamInt     0   Inf     Inf                0              \n#> ---                                                                          \n#> 12:            nu ParamDbl  -Inf   Inf     Inf              0.5    type      \n#> 13:         scale ParamUty    NA    NA     Inf             TRUE              \n#> 14:     shrinking ParamLgl    NA    NA       2             TRUE              \n#> 15:     tolerance ParamDbl     0   Inf     Inf            0.001              \n#> 16:          type ParamFct    NA    NA       2 C-classification\n```\n:::\n\n\n## ç‹¬ç«‹è°ƒå‚\n\né€‚åˆä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ å¥—è·¯ï¼šå°†æ•°æ®é›†æŒ‰ç•™å‡ºæ³•é‡æŠ½æ ·åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œåœ¨è®­ç»ƒé›†ä¸Šåšå†…å±‚é‡æŠ½æ ·ï¼Œå¤šæ¬¡â€œè®­ç»ƒé›†æ‹Ÿåˆæ¨¡å‹+ éªŒè¯é›†è¯„ä¼°æ€§èƒ½â€ï¼Œæ ¹æ®å¹³å‡æ€§èƒ½é€‰å‡ºæœ€ä¼˜è¶…å‚æ•°ã€‚\n\n1. é€‰å–ä»»åŠ¡ï¼Œåˆ’åˆ†æ•°æ®é›†ï¼Œå°†æµ‹è¯•é›†ç´¢å¼•è®¾ç½®ä¸ºç•™å‡º\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"iris\")\nsplit = partition(task, ratio = .8)\ntask$set_row_roles(split$test, \"holdout\")\n```\n:::\n\n\n2. é€‰æ‹©å­¦ä¹ å™¨ï¼ŒåŒæ—¶æŒ‡å®šéƒ¨åˆ†è¶…å‚æ•°ï¼Œéœ€è¦è°ƒå‚çš„è¶…å‚æ•°ç”¨ `to_tune()` è®¾å®šæœç´¢èŒƒå›´ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlearner = lrn(\"classif.svm\", type = \"C-classification\", kernel = \"radial\",\n              cost = to_tune(.1, 10), gamma = to_tune(0, 5))\n```\n:::\n\n\n3. ç”¨ `tune()` å¯¹å­¦ä¹ å™¨åšè¶…å‚æ•°è°ƒå‚ï¼Œéœ€è¦è®¾å®šï¼ˆæœ‰äº›æ˜¯å¯é€‰ï¼‰ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstance = tune(\n  tuner = tnr(\"grid_search\", batch_size = 5),\n  task = task,\n  learner = learner,\n  resampling = rsmp(\"cv\", folds = 5),\n  measures = msr(\"classif.ce\")\n)\n```\n:::\n\n\n4. æå–è¶…å‚æ•°è°ƒå‚ç»“æœ\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstance$result\n#>    cost     gamma learner_param_vals  x_domain classif.ce\n#> 1:  5.6 0.5555556          <list[4]> <list[2]> 0.03333333\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstance$archive  # è°ƒå‚æ¡£æ¡ˆ\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nautoplot(instance, type = \"surface\", cols_x = c(\"cost\", \"gamma\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-146-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n5. ç”¨æœ€ä¼˜è¶…å‚æ•°æ›´æ–°å­¦ä¹ å™¨å‚æ•°ï¼Œåœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œåœ¨æµ‹è¯•é›†ä¸Šåšé¢„æµ‹\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlearner$param_set$values = instance$result_learner_param_vals\nlearner$train(task)\npredictions = learner$predict(task, row_ids = split$test)\npredictions\n#> <PredictionClassif> for 30 observations:\n#>     row_ids     truth  response\n#>           5    setosa    setosa\n#>          13    setosa    setosa\n#>          15    setosa    setosa\n#> ---                            \n#>         142 virginica virginica\n#>         144 virginica virginica\n#>         146 virginica virginica\n```\n:::\n\n\n## è‡ªåŠ¨è°ƒå‚å™¨\n\nä¸Šè¿°ç‹¬ç«‹è°ƒå‚æœ‰ä¸¤ä¸ªä¸è¶³ï¼š\n\n- è°ƒå‚å¾—åˆ°çš„æœ€ä¼˜è¶…å‚æ•°éœ€è¦æ‰‹åŠ¨æ›´æ–°åˆ°å­¦ä¹ å™¨ï¼›\n\n- ä¸æ–¹ä¾¿å®ç°åµŒå¥—é‡æŠ½æ ·ã€‚\n\nè‡ªåŠ¨è°ƒå‚å™¨å¯ä»¥å¼¥è¡¥ä¸Šè¿°ä¸è¶³ï¼ŒAutoTuner æ˜¯å°†è¶…å‚æ•°è°ƒå‚ä¸å­¦ä¹ å™¨å°è£…åˆ°ä¸€èµ·ï¼Œèƒ½å®ç°è‡ªåŠ¨è°ƒå‚çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥åƒå…¶ä»–å­¦ä¹ å™¨ä¸€æ ·ä½¿ç”¨ã€‚\n\n1. åˆ›å»ºä»»åŠ¡ã€é€‰æ‹©å­¦ä¹ å™¨\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"iris\")\nlearner = lrn(\"classif.svm\", type = \"C-classification\", kernel = \"radial\")\n```\n:::\n\n\n2. ç”¨ `ps()` ç”Ÿæˆæœç´¢ç©ºé—´ï¼Œç”¨ `auto_tuner()` åˆ›å»ºè‡ªåŠ¨è°ƒå‚å™¨ï¼Œæ³¨æ„ï¼šä¸éœ€è¦æä¾›ä»»åŠ¡ï¼Œå…¶å®ƒå‚æ•°ä¸ç‹¬ç«‹è°ƒå‚çš„ `tune()` åŸºæœ¬ä¸€æ ·ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsearch_space = ps(cost = p_dbl(0.1, 10), gamma = p_int(0, 5))\nat = auto_tuner(\n  tuner = tnr(\"grid_search\"),\n  learner = learner,\n  search_space = search_space,\n  resampling = rsmp(\"cv\", folds = 5),\n  measure = msr(\"classif.ce\")\n)\n```\n:::\n\n\n3. å¤–å±‚é‡‡ç”¨ 4 æŠ˜äº¤å‰éªŒè¯é‡æŠ½æ ·ï¼Œè®¾ç½® `store_models = TRUE` ä¿å­˜æ¯æ¬¡çš„æ¨¡å‹ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr = resample(task, at, rsmp(\"cv\", folds = 4), store_models = TRUE)\n```\n:::\n\n\nè¿™å°±æ˜¯æ‰§è¡ŒåµŒå¥—é‡æŠ½æ ·ï¼Œå¤–å±‚ï¼ˆæ•´ä½“æ‹Ÿåˆæ¨¡å‹+ è¯„ä¼°ï¼‰å¾ªç¯ 4 æ¬¡ï¼Œæ¯æ¬¡å†…å±‚ï¼ˆè¶…å‚æ•°è°ƒå‚ï¼‰å¾ªç¯ 5 æ¬¡ã€‚\n\n4. æŸ¥çœ‹ç»“æœï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr$aggregate()  # æ€»çš„å¹³å‡æ¨¡å‹æ€§èƒ½, ä¹Ÿå¯ä»¥æä¾›å…¶å®ƒåº¦é‡\n#> classif.ce \n#> 0.06009957\nrr$score()      # å¤–å±‚ 4 æ¬¡è¿­ä»£çš„æ¯æ¬¡ç»“æœ\n#>    task_id        learner_id resampling_id iteration classif.ce\n#> 1:    iris classif.svm.tuned            cv         1 0.07894737\n#> 2:    iris classif.svm.tuned            cv         2 0.02631579\n#> 3:    iris classif.svm.tuned            cv         3 0.05405405\n#> 4:    iris classif.svm.tuned            cv         4 0.08108108\n#> Hidden columns: task, learner, resampling, prediction\nextract_inner_tuning_results(rr)  # å†…å±‚æ¯æ¬¡çš„è°ƒå‚ç»“æœ\n#>    iteration cost gamma classif.ce learner_param_vals  x_domain task_id\n#> 1:         1 10.0     1 0.04505929          <list[4]> <list[2]>    iris\n#> 2:         2  1.2     1 0.05375494          <list[4]> <list[2]>    iris\n#> 3:         3  2.3     3 0.04466403          <list[4]> <list[2]>    iris\n#> 4:         4  8.9     1 0.05335968          <list[4]> <list[2]>    iris\n#>           learner_id resampling_id\n#> 1: classif.svm.tuned            cv\n#> 2: classif.svm.tuned            cv\n#> 3: classif.svm.tuned            cv\n#> 4: classif.svm.tuned            cv\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nextract_inner_tuning_archives(rr) # å†…å±‚è°ƒå‚æ¡£æ¡ˆ\n```\n:::\n\n\n5. åœ¨å…¨éƒ¨æ•°æ®ä¸Šè‡ªåŠ¨è°ƒå‚ï¼Œé¢„æµ‹æ–°æ•°æ®\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nat$train(task)\ndat = task$data()[1:5, -1]\nat$predict_newdata(dat)\n```\n:::\n\n\næ³¨ï¼šè°ƒå‚ç»“æŸåï¼Œä¹Ÿå¯ä»¥å–å‡ºæœ€ä¼˜è¶…å‚æ•°ï¼Œæ›´æ–°å­¦ä¹ å™¨å‚æ•°ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlearner$param_set$values = at$tuning_result$learner_param_vals[[1]]\n```\n:::\n\n\næˆ–è€…æŒ‰æœ€ä¼˜è¶…å‚æ•°é‡æ–°åˆ›å»ºå­¦ä¹ å™¨ã€‚\n\nå¦å¤–ï¼Œä¸Šè¿°çš„â€œè‡ªåŠ¨è°ƒå‚+ å¤–å±‚é‡æŠ½æ ·â€ï¼Œè‹¥æ”¹ç”¨åµŒå¥—è°ƒå‚ `tune_nested()` å®ç°ï¼Œä»£ç ä¼šæ›´åŠ ç®€æ´ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr = tune_nested(\n  tuner = tnr(\"grid_search\"),\n  task = task,\n  learner = learner,\n  search_space = search_space,\n  inner_resampling = rsmp(\"cv\", folds = 5),\n  outer_resampling = rsmp(\"cv\", folds = 4),\n  measure = msr(\"classif.ce\")\n)\n```\n:::\n\n\n## å®šåˆ¶æœç´¢ç©ºé—´\n\nç”¨ `ps()` åˆ›å»ºæœç´¢ç©ºé—´ï¼Œå®ƒæ”¯æŒ 5 ç§è¶…å‚æ•°ç±»å‹æ„å»ºï¼š\n\n- `p_dbl()`ï¼šå®å€¼å‹ï¼ˆdoubleï¼‰\n\n- `p_int()`ï¼šæ•´æ•°å‹\n\n- `p_fct()`ï¼šç¦»æ•£å‹ï¼ˆfactorï¼‰\n\n- `p_lgl()`ï¼šé€»è¾‘æ€§\n\n- `p_uty()`ï¼šUntyped\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsearch_space = ps(cost = p_dbl(.1, 10),\n                  kernel = p_fct(c(\"polynomial\", \"radial\")))\n```\n:::\n\n\n### å˜æ¢\n\nå¯¹äºæ•°å€¼å‹è¶…å‚æ•°ï¼Œåœ¨è°ƒå‚æ—¶ç»å¸¸å¸Œæœ›å‰æœŸçš„ç‚¹æ¯”åæœŸçš„ç‚¹æ›´å¯†é›†ä¸€äº›ã€‚è¿™å¯ä»¥é€šè¿‡å¯¹æ•°-æŒ‡æ•°å˜æ¢æ¥å®ç°ï¼Œè¿™ä¹Ÿé€‚ç”¨äºå¤§èŒƒå›´æœç´¢ç©ºé—´ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntibble(x = 1:20,\n       y = exp(seq(log(3), log(50), length.out = 20))) %>% \n  ggplot(aes(x, y)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-157-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nå½“ $x$ å‡åŒ€å˜åŒ–æ—¶ï¼Œå˜æ¢åä½œä¸ºè¶…å‚æ•°èƒ½å‰å¯†åç–ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsearch_space = ps(\n  cost = p_dbl(log(.1), log(10), trafo = \\(x) exp(x)),\n  kernel = p_fct(c(\"polynomial\", \"radial\"))\n)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# æŸ¥çœ‹è°ƒå‚ç½‘æ ¼\nparams = generate_design_grid(search_space, resolution = 5)\nparams\n#> <Design> with 10 rows:\n#>              cost     kernel\n#>  1: -2.302585e+00 polynomial\n#>  2: -2.302585e+00     radial\n#>  3: -1.151293e+00 polynomial\n#>  4: -1.151293e+00     radial\n#>  5:  2.220446e-16 polynomial\n#>  6:  2.220446e-16     radial\n#>  7:  1.151293e+00 polynomial\n#>  8:  1.151293e+00     radial\n#>  9:  2.302585e+00 polynomial\n#> 10:  2.302585e+00     radial\n```\n:::\n\n\n### ä¾èµ–å…³ç³»\n\næœ‰äº›è¶…å‚æ•°åªæœ‰åœ¨å¦ä¸€ä¸ªå‚æ•°å–æŸäº›å€¼æ—¶æ‰æœ‰æ„ä¹‰ã€‚ä¾‹å¦‚ï¼Œæ”¯æŒå‘é‡æœºæœ‰ä¸€ä¸ª `degree` å‚æ•°ï¼Œåªæœ‰åœ¨ `kernel` ä¸º â€polynomialâ€ æ—¶æ‰æœ‰æ•ˆã€‚è¿™å¯ä»¥ç”¨ `depends` å‚æ•°æ¥æŒ‡å®šï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsearch_space = ps(\n  cost = p_dbl(log(.1), log(10), trafo = \\(x) exp(x)),\n  kernel = p_fct(c(\"polynomial\", \"radial\")),\n  degree = p_int(1, 3, depends = kernel == \"polynomial\")\n)\n```\n:::\n\n\n### å›¾å­¦ä¹ å™¨è°ƒå‚\n\nå›¾å­¦ä¹ å™¨ä¸€æ—¦æˆåŠŸåˆ›å»ºï¼Œå°±å¯ä»¥åƒæ™®é€šå­¦ä¹ å™¨ä¸€æ ·ä½¿ç”¨ï¼Œè¶…å‚æ•°è°ƒå‚æ—¶ï¼ŒåŸç®—æ³•çš„è¶…å‚æ•°åå­—éƒ½è‡ªåŠ¨å¸¦äº†å­¦ä¹ å™¨åå­—å‰ç¼€ï¼Œå¦å¤–è¿˜å¯ä»¥å¯¹ç®¡é“å‚æ•°è°ƒå‚ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"pima\")\n```\n:::\n\n\nè¯¥ä»»åŠ¡åŒ…å«ç¼ºå¤±å€¼ï¼Œè¿˜æœ‰è‹¥å¹²å› å­ç‰¹å¾ï¼Œéƒ½éœ€è¦åšé¢„å¤„ç†ï¼šæ’è¡¥å’Œç‰¹å¾å·¥ç¨‹ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprep = gunion(list(\n  po(\"imputehist\"),\n  po(\"missind\", affect_columns = selector_type(c(\"numeric\", \"integer\")))\n)) %>>%\n  po(\"featureunion\") %>>%\n  po(\"encode\") %>>%\n  po(\"removeconstants\")\n```\n:::\n\n\né€‰æ‹©ä¸‰ä¸ªå­¦ä¹ å™¨ï¼šKNNã€SVMã€Ranger ä½œä¸ºä¸‰åˆ†æ”¯åˆ†åˆ«æ‹Ÿåˆæ¨¡å‹ï¼Œå†åˆå¹¶åˆ†æ”¯ä¿è¯æ˜¯ä¸€ä¸ªè¾“å‡ºç»“æœï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlearners = list(\n  knn = lrn(\"classif.kknn\", id = \"kknn\"),\n  svm = lrn(\"classif.svm\", id = \"svm\", type = \"C-classification\"),\n  rf = lrn(\"classif.ranger\", id = \"ranger\")\n)\ngraph = ppl(\"branch\", learners)\n```\n:::\n\n\nå°†é¢„å¤„ç†å›¾å’Œç®—æ³•å›¾è¿æ¥å¾—åˆ°æ•´ä¸ªå›¾ï¼Œå¹¶å¯è§†åŒ–å›¾ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngraph = prep %>>% graph\ngraph$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-164-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nè½¬åŒ–ä¸ºå›¾å­¦ä¹ å™¨ï¼ŒæŸ¥çœ‹å…¶è¶…å‚æ•°ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglearner = as_learner(graph)\nglearner$param_set\n#> <ParamSetCollection>\n#>                            id    class lower upper nlevels          default\n#>  1:          branch.selection ParamFct    NA    NA       3   <NoDefault[3]>\n#>  2:     encode.affect_columns ParamUty    NA    NA     Inf    <Selector[1]>\n#>  3:             encode.method ParamFct    NA    NA       5   <NoDefault[3]>\n#>  4: imputehist.affect_columns ParamUty    NA    NA     Inf   <NoDefault[3]>\n#>  5:             kknn.distance ParamDbl     0   Inf     Inf                2\n#> ---                                                                        \n#> 59:                    svm.nu ParamDbl  -Inf   Inf     Inf              0.5\n#> 60:                 svm.scale ParamUty    NA    NA     Inf             TRUE\n#> 61:             svm.shrinking ParamLgl    NA    NA       2             TRUE\n#> 62:             svm.tolerance ParamDbl     0   Inf     Inf            0.001\n#> 63:                  svm.type ParamFct    NA    NA       2 C-classification\n#>      parents            value\n#>  1:                       knn\n#>  2:                          \n#>  3:                   one-hot\n#>  4:                          \n#>  5:                          \n#> ---                          \n#> 59: svm.type                 \n#> 60:                          \n#> 61:                          \n#> 62:                          \n#> 63:          C-classification\n```\n:::\n\n\nå¯è§ï¼Œæ‰€æœ‰è¶…å‚æ•°éƒ½å¤šäº†å­¦ä¹ å™¨æˆ–ç®¡é“åå­—å‰ç¼€ï¼Œæ¯”å¦‚ kknn.k æ˜¯KNN å­¦ä¹ å™¨çš„é‚»å±…æ•°å‚æ•° kã€‚\n\nåµŒå¥—é‡æŠ½æ ·è¶…å‚æ•°è°ƒå‚ï¼Œä¸å‰æ–‡è¯­æ³•ä¸€æ ·ï¼Œä¸ºäº†åŠ é€Ÿè®¡ç®—ï¼Œå¯åŠ¨å¹¶è¡Œï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfuture::plan(\"multicore\")\n```\n:::\n\n\nè®¾ç½®æœç´¢ç©ºé—´ï¼Œç”¨ `tune_nested()` åšåµŒå¥—è°ƒå‚ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsearch_space = ps(\n  branch.selection = p_fct(c(\"kknn\", \"svm\", \"ranger\")),\n  kknn.k = p_int(3, 50, logscale = TRUE,\n                 depends = branch.selection == \"kknn\"),\n  svm.cost = p_dbl(-1, 1, trafo = \\(x) 10^x,\n                   depends = branch.selection == \"svm\"),\n  ranger.mtry = p_int(1, 8,\n                      depends = branch.selection == \"ranger\")\n)\nrr = tune_nested(\n  tuner = tnr(\"random_search\"),\n  task = task,\n  learner = glearner,\n  inner_resampling = rsmp(\"cv\", folds = 3),\n  outer_resampling = rsmp(\"cv\", folds = 4),\n  measure = msr(\"classif.ce\"),\n  term_evals = 10\n)\n```\n:::\n\n\næŸ¥çœ‹ç»“æœï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr$aggregate()    # æ€»çš„å¹³å‡æ¨¡å‹æ€§èƒ½\n#> classif.ce \n#>   0.296875\nrr$score()        # å¤–å±‚ 4 æ¬¡è¿­ä»£æ¯æ¬¡çš„æ¨¡å‹æ€§èƒ½\n#>    task_id\n#> 1:    pima\n#> 2:    pima\n#> 3:    pima\n#> 4:    pima\n#>                                                                                      learner_id\n#> 1: imputehist.missind.featureunion.encode.removeconstants.branch.kknn.svm.ranger.unbranch.tuned\n#> 2: imputehist.missind.featureunion.encode.removeconstants.branch.kknn.svm.ranger.unbranch.tuned\n#> 3: imputehist.missind.featureunion.encode.removeconstants.branch.kknn.svm.ranger.unbranch.tuned\n#> 4: imputehist.missind.featureunion.encode.removeconstants.branch.kknn.svm.ranger.unbranch.tuned\n#>    resampling_id iteration classif.ce\n#> 1:            cv         1  0.3854167\n#> 2:            cv         2  0.2239583\n#> 3:            cv         3  0.3020833\n#> 4:            cv         4  0.2760417\n#> Hidden columns: task, learner, resampling, prediction\n```\n:::\n\n\n# ç‰¹å¾é€‰æ‹©\n\nå½“æ•°æ®é›†åŒ…å«å¾ˆå¤šç‰¹å¾æ—¶ï¼Œåªæå–æœ€é‡è¦çš„éƒ¨åˆ†ç‰¹å¾æ¥å»ºæ¨¡ï¼Œç§°ä¸º**ç‰¹å¾é€‰æ‹©**ã€‚ç‰¹å¾é€‰æ‹©å¯ä»¥å¢å¼ºæ¨¡å‹çš„è§£é‡Šæ€§ã€åŠ é€Ÿå­¦ä¹ è¿‡ç¨‹ã€æ”¹è¿›å­¦ä¹ å™¨æ€§èƒ½ã€‚\n\nå¸¸ç”¨çš„ç‰¹å¾é€‰æ‹©æ–¹æ³•æœ‰ä¸¤ç§ï¼šè¿‡æ»¤æ³•ã€åŒ…è£…æ³•ã€‚å¦å¤–ï¼Œæœ‰äº›å­¦ä¹ å™¨å†…éƒ¨æä¾›äº†é€‰æ‹©æœ‰åŠ©äºåšé¢„æµ‹çš„ç‰¹å¾å­é›†çš„æ–¹æ³•ï¼Œç§°ä¸ºæ˜¯åµŒå…¥æ³•ã€‚\n\n## è¿‡æ»¤æ³•\n\nè¿‡æ»¤æ³•ï¼ŒåŸºäºæŸç§è¡¡é‡ç‰¹å¾é‡è¦åº¦çš„æŒ‡æ ‡ï¼ˆå¦‚ç›¸å…³ç³»æ•°ï¼‰ï¼Œç”¨å¤–éƒ¨ç®—æ³•è®¡ç®—å˜é‡çš„æ’åï¼Œåªé€‰ç”¨æ’åé å‰çš„è‹¥å¹²ç‰¹å¾ï¼Œç”¨ mlr3filters åŒ…å®ç°ã€‚\n\n### åŸºäºé‡è¦åº¦æŒ‡æ ‡\n\nè¿‡æ»¤æ³•ç»™æ¯ä¸ªç‰¹å¾è®¡ç®—ä¸€ä¸ªé‡è¦åº¦æŒ‡æ ‡å€¼ï¼ŒåŸºäºæ­¤å¯ä»¥å¯¹ç‰¹å¾è¿›è¡Œæ’åºï¼Œç„¶åå°±å¯ä»¥é€‰å‡ºç‰¹å¾å­é›†ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"sonar\")\nfilter = flt(\"auc\")\nas.data.table(filter$calculate(task))\n#>     feature       score\n#>  1:     V11 0.281136807\n#>  2:     V12 0.242918176\n#>  3:     V10 0.232701774\n#>  4:     V49 0.231262190\n#>  5:      V9 0.230844246\n#> ---                    \n#> 56:     V60 0.012213244\n#> 57:     V30 0.006965729\n#> 58:     V57 0.004876010\n#> 59:     V55 0.003204235\n#> 60:     V40 0.002182595\n```\n:::\n\n\n### åŸºäºå­¦ä¹ å™¨çš„å˜é‡é‡è¦åº¦\n\næœ‰äº›å­¦ä¹ å™¨å¯ä»¥è®¡ç®—å˜é‡é‡è¦åº¦ï¼Œç‰¹åˆ«æ˜¯åŸºäºæ ‘çš„æ¨¡å‹ï¼Œç›®å‰æ”¯æŒï¼š\n\n\"classif.featureless\"ï¼Œ\"regr.featureless\"ï¼Œ\"classif.ranger\"ï¼Œ\"regr.ranger\"ï¼Œ\"classif.rpart\"ï¼Œ\"regr.rpart\"ï¼Œ\"classif.xgboost\"ï¼Œ\"regr.xgboost\"\n\næœ‰äº›å­¦ä¹ å™¨éœ€è¦åœ¨åˆ›å»ºæ—¶â€ æ¿€æ´»â€ å…¶å˜é‡é‡è¦æ€§åº¦é‡ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ ranger åŒ…æ¥ä½¿ç”¨éšæœºæ£®æ—çš„ â€impurityâ€ åº¦é‡ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"iris\")\nlearner = lrn(\"classif.ranger\", importance = \"impurity\")\nfilter = flt(\"importance\", learner = learner)\nfilter$calculate(task)\nas.data.table(filter)\n#>         feature     score\n#> 1:  Petal.Width 45.511305\n#> 2: Petal.Length 41.987469\n#> 3: Sepal.Length  9.381471\n#> 4:  Sepal.Width  2.361094\n```\n:::\n\n\nä½¿ç”¨ä¸Šè¿°ç‰¹å¾é€‰æ‹©å¯ä»¥å¯¹ç‰¹å¾å¾—åˆ†å¯è§†åŒ–ï¼Œæ ¹æ®è‚˜æ³•ç¡®å®šä¿ç•™ç‰¹å¾æ•°ï¼Œç„¶åç”¨ `task$select()` é€‰æ‹©ç‰¹å¾ï¼›ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ç®¡é“è¿æ¥å­¦ä¹ å™¨æ„å»ºå›¾å­¦ä¹ å™¨ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"spam\")\ngraph = po(\"filter\", filter = flt(\"auc\"), filter.frac = .5) %>>%\n  po(\"learner\", lrn(\"classif.rpart\"))\ngraph$plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-171-1.png){fig-align='center' width=70%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlearner = as_learner(graph)\nrr = resample(task, learner, rsmp(\"cv\", folds = 5))\n#> INFO  [15:14:48.723] [mlr3] Applying learner 'auc.classif.rpart' on task 'spam' (iter 1/5)\n#> INFO  [15:14:48.900] [mlr3] Applying learner 'auc.classif.rpart' on task 'spam' (iter 2/5)\n#> INFO  [15:14:49.141] [mlr3] Applying learner 'auc.classif.rpart' on task 'spam' (iter 3/5)\n#> INFO  [15:14:49.364] [mlr3] Applying learner 'auc.classif.rpart' on task 'spam' (iter 4/5)\n#> INFO  [15:14:49.552] [mlr3] Applying learner 'auc.classif.rpart' on task 'spam' (iter 5/5)\nrr$aggregate()\n#> classif.ce \n#>  0.1051952\n```\n:::\n\n\n## åŒ…è£…æ³•\n\nåŒ…è£…æ³•ï¼Œéšæœºé€‰æ‹©éƒ¨åˆ†ç‰¹å¾æ‹Ÿåˆæ¨¡å‹å¹¶è¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œé€šè¿‡äº¤å‰éªŒè¯æ‰¾åˆ°æœ€ä½³çš„ç‰¹å¾å­é›†ï¼Œç”¨ mlr3fselect åŒ…å®ç°ã€‚\n\nåŒ…è£…æ³•ç‰¹å¾é€‰æ‹©ï¼Œä¸è¶…å‚æ•°è°ƒå‚é“ç†å®Œå…¨ä¸€æ ·ã€‚\n\n### ç‹¬ç«‹ç‰¹å¾é€‰æ‹©\n\né€‚åˆä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ å¥—è·¯ï¼šå°†æ•°æ®é›†æŒ‰ç•™å‡ºæ³•é‡æŠ½æ ·åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œåœ¨è®­ç»ƒé›†ä¸Šåšå†…å±‚é‡æŠ½æ ·ï¼Œå¤šæ¬¡â€œè®­ç»ƒé›†æ‹Ÿåˆæ¨¡å‹ + éªŒè¯é›†è¯„ä¼°æ€§èƒ½â€ï¼Œæ ¹æ®å¹³å‡æ€§èƒ½é€‰å‡ºæœ€ä¼˜ç‰¹å¾å­é›†ã€‚\n\n1. é€‰å–ä»»åŠ¡ï¼Œåˆ’åˆ†æ•°æ®é›†ï¼Œå°†æµ‹è¯•é›†ç´¢å¼•è®¾ç½®ä¸ºç•™å‡º\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"pima\")\nsplit = partition(task, ratio = .8)\ntask$set_row_roles(split$test, \"holdout\")\n```\n:::\n\n\n2. é€‰æ‹©å­¦ä¹ å™¨\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlearner = lrn(\"classif.rpart\")\n```\n:::\n\n\n3. ç”¨ `fselect()` å¯¹å­¦ä¹ å™¨åšç‰¹å¾é€‰æ‹©\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstance = fselect(\n  fselector = fs(\"rfe\"),\n  task = task,\n  learner = learner,\n  resampling = rsmp(\"cv\", folds = 4),\n  measures = msr(\"classif.ce\"),\n  term_evals = 10,\n  store_models = TRUE\n)\n```\n:::\n\n\næŸ¥çœ‹ç‰¹å¾é€‰æ‹©ç»“æœï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstance$result  # æœ€ä½³ç‰¹å¾å­é›†\n#>     age glucose insulin mass pedigree pregnant pressure triceps\n#> 1: TRUE    TRUE   FALSE TRUE     TRUE    FALSE    FALSE   FALSE\n#>                     features classif.ce\n#> 1: age,glucose,mass,pedigree  0.2801227\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstance$archive  # ç‰¹å¾é€‰æ‹©æ¡£æ¡ˆ\n#> <ArchiveFSelect>\n#>     age glucose insulin mass pedigree pregnant pressure triceps classif.ce\n#> 1: TRUE    TRUE    TRUE TRUE     TRUE     TRUE     TRUE    TRUE       0.29\n#> 2: TRUE    TRUE   FALSE TRUE     TRUE    FALSE    FALSE   FALSE       0.28\n#>    warnings errors runtime_learners  x_domain              timestamp batch_nr\n#> 1:        0      0             0.08 <list[8]> 2023-09-12 15:14:50.35        1\n#> 2:        0      0             0.07 <list[8]> 2023-09-12 15:14:50.65        2\n#>                     importance\n#> 1: 8.0,6.8,5.2,4.8,4.8,2.8,...\n#> 2:             4.0,2.5,2.0,1.5\n```\n:::\n\n\n4. å¯¹ä»»åŠ¡é€‰æ‹©ç‰¹å¾è‡ªå·±ï¼Œæ‹Ÿåˆæœ€ç»ˆæ¨¡å‹\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask$select(instance$result_feature_set)\nlearner$train(task)\n```\n:::\n\n\n### è‡ªåŠ¨ç‰¹å¾é€‰æ‹©\n\nä¸Šè¿°ç‹¬ç«‹ç‰¹å¾é€‰æ‹©æœ‰ä¸¤ä¸ªä¸è¶³ï¼š\n\n- ç‰¹å¾é€‰æ‹©å¾—åˆ°çš„æœ€ä¼˜ç‰¹å¾å­é›†éœ€è¦æ‰‹åŠ¨æ›´æ–°åˆ°ä»»åŠ¡ï¼›\n\n- ä¸æ–¹ä¾¿å®ç°åµŒå¥—é‡æŠ½æ ·ã€‚\n\nè‡ªåŠ¨ç‰¹å¾é€‰æ‹©å™¨å¯ä»¥å¼¥è¡¥ä¸Šè¿°ä¸è¶³ï¼ŒAutoFSelector æ˜¯å°†ç‰¹å¾é€‰æ‹©ä¸å­¦ä¹ å™¨å°è£…åˆ°ä¸€èµ·ï¼Œèƒ½å®ç°è‡ªåŠ¨ç‰¹å¾é€‰æ‹©çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥åƒå…¶ä»–å­¦ä¹ å™¨ä¸€æ ·ä½¿ç”¨ã€‚\n\n1. åˆ›å»ºä»»åŠ¡ã€é€‰æ‹©å­¦ä¹ å™¨\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = tsk(\"pima\")\nlearner = lrn(\"classif.rpart\")\n```\n:::\n\n\n2. ç”¨ `auto_fselector()` åˆ›å»ºè‡ªåŠ¨ç‰¹å¾é€‰æ‹©å™¨ï¼Œæ³¨æ„ï¼šä¸éœ€è¦æä¾›ä»»åŠ¡ï¼Œå…¶å®ƒå‚æ•°ä¸ç‹¬ç«‹ç‰¹å¾é€‰æ‹©çš„ `fselect()` åŸºæœ¬ä¸€æ ·ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nafs = auto_fselector(\n  fselector = fs(\"random_search\", batch_size = 5),\n  learner = lrn(\"classif.rpart\"),\n  resampling = rsmp(\"cv\", folds = 4),\n  measure = msr(\"classif.ce\"),\n  term_evals = 10\n)\n```\n:::\n\n\n3. å¤–å±‚é‡‡ç”¨ 5 æŠ˜äº¤å‰éªŒè¯é‡æŠ½æ ·ï¼Œè®¾ç½® `store_models = TRUE` ä¿å­˜æ¯æ¬¡çš„æ¨¡å‹ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr = resample(task, afs, rsmp(\"cv\", folds = 5), store_models = TRUE)\n```\n:::\n\n\næŸ¥çœ‹ç»“æœï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr$aggregate()  # æ€»çš„å¹³å‡æ¨¡å‹æ€§èƒ½, ä¹Ÿå¯ä»¥æä¾›å…¶å®ƒåº¦é‡\n#> classif.ce \n#>  0.2746796\n```\n:::\n\n\næ³¨ï¼šè‹¥å¤–å±‚é‡æŠ½æ ·ä¸æƒ³åšè¿™ä¹ˆå¤šæ¬¡ï¼Œå¯ç›´æ¥ç”¨ç•™å‡ºé‡æŠ½æ ·ï¼Œæˆ–è€…åˆ’åˆ†è®­ç»ƒé›†æµ‹è¯•é›†ï¼Œç„¶åå°† afs å½“å­¦ä¹ å™¨ä½¿ç”¨ã€‚\n\nå¦å¤–ï¼Œä¸Šè¿°çš„â€œè‡ªåŠ¨ç‰¹å¾é€‰æ‹©+ å¤–å±‚é‡æŠ½æ ·â€ï¼Œè‹¥æ”¹ç”¨åµŒå¥—ç‰¹å¾é€‰æ‹© `fselect_nested()` å®ç°ï¼Œä»£ç ä¼šæ›´åŠ ç®€æ´ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrr = fselect_nested(\n  fselector = fs(\"random_search\", batch_size = 5),\n  task = tsk(\"pima\"),\n  learner = lrn(\"classif.rpart\"),\n  inner_resampling = rsmp(\"cv\", folds = 4),\n  outer_resampling = rsmp(\"cv\", folds = 5),\n  measure = msr(\"classif.ce\"),\n  term_evals = 10\n)\n```\n:::\n\n\n# æ¨¡å‹è§£é‡Š\n\næœºå™¨å­¦ä¹ æ¨¡å‹é¢„æµ‹æ€§èƒ½å¼ºå¤§ï¼Œä½†å¤©ç”Ÿä¸å¥½è§£é‡Šã€‚R æœ‰ä¸¤ä¸ªé€šç”¨æ¡†æ¶è‡´åŠ›äºæœºå™¨å­¦ä¹ æ¨¡å‹çš„è§£é‡Šï¼ˆæ”¯æŒä½†ä¸å±äº mlr3verseï¼‰ï¼šiml åŒ…å’Œ DALEX åŒ…ã€‚\n\n## iml åŒ…\n\niml åŒ…æä¾›äº†åˆ†æä»»ä½•é»‘ç›’æœºå™¨å­¦ä¹ æ¨¡å‹çš„å·¥å…·ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndat = tsk(\"penguins\")$data() %>% na.omit()\ntask = as_task_classif(dat, target = \"species\")\nlearner = lrn(\"classif.ranger\", predict_type = \"prob\")\nlearner$train(task)\nlearner$model\n#> Ranger result\n#> \n#> Call:\n#>  ranger::ranger(dependent.variable.name = task$target_names, data = task$data(),      probability = self$predict_type == \"prob\", case.weights = task$weights$weight,      num.threads = 1L) \n#> \n#> Type:                             Probability estimation \n#> Number of trees:                  500 \n#> Sample size:                      333 \n#> Number of independent variables:  7 \n#> Mtry:                             2 \n#> Target node size:                 10 \n#> Variable importance mode:         none \n#> Splitrule:                        gini \n#> OOB prediction error (Brier s.):  0.01793959\n```\n:::\n\n\niml åŒ…ä¸­çš„æ‰€æœ‰è§£é‡Šæ–¹æ³•éƒ½éœ€è¦æœºå™¨å­¦ä¹ æ¨¡å‹å’Œæ•°æ®å°è£…åœ¨ Predictor å¯¹è±¡ä¸­ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(iml)\n```\n:::\n\n\n### ç‰¹å¾æ•ˆåº”\n\nç‰¹å¾æ•ˆåº”ï¼ˆFeatureEffectsï¼‰ï¼Œæ˜¯è®¡ç®—æ‰€æœ‰ç»™å®šç‰¹å¾å¯¹æ¨¡å‹é¢„æµ‹çš„å½±å“ã€‚å®ç°äº†ä¸åŒçš„æ–¹æ³•ï¼šç´¯ç§¯å±€éƒ¨æ•ˆåº”ï¼ˆALEï¼‰å›¾ï¼Œéƒ¨åˆ†ä¾èµ–å›¾ï¼ˆPDPï¼‰å’Œä¸ªä½“æ¡ä»¶æœŸæœ›ï¼ˆICEï¼‰æ›²çº¿ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod = Predictor$new(learner, data = dat, y = \"species\")\neffect = FeatureEffects$new(mod)\neffect$plot(features = c(\"bill_length\", \"bill_depth\",\n                         \"flipper_length\", \"body_mass\", \"year\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-186-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nå¯è§ï¼Œé™¤äº†å¹´ä»½ï¼Œæ‰€æœ‰çš„ç‰¹å¾éƒ½æä¾›äº†æœ‰æ„ä¹‰çš„å¯è§£é‡Šä¿¡æ¯ã€‚\n\n### å¤æ™®åˆ©å€¼\n\nè®¡ç®—å…·æœ‰å¤æ™®åˆ©ï¼ˆShapleyï¼‰å€¼çš„å•ä¸ªè§‚æµ‹çš„ç‰¹å¾è´¡çŒ®ï¼ˆä¸€ç§æ¥è‡ªåˆä½œåšå¼ˆç†è®ºçš„æ–¹æ³•ï¼‰ï¼Œå³å•ä¸ªæ•°æ®ç‚¹çš„ç‰¹å¾å€¼æ˜¯å¦‚ä½•å½±å“å…¶é¢„æµ‹çš„ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod = Predictor$new(learner, data = dat, y = \"species\")\nshapley = Shapley$new(mod, x.interest = dat[1,])\nplot(shapley)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-187-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n$\\phi$å€¼ç»™å‡ºäº†çºµè½´ä¸Šæ•°å€¼çš„æ¦‚ç‡å¢åŠ æˆ–å‡å°‘ï¼Œä¾‹å¦‚ï¼Œå¦‚æœ `bill_depth = 18.7`ï¼Œé‚£ä¹ˆä¸€åªä¼é¹…æ˜¯ Gentoo ä¼é¹…çš„å¯èƒ½æ€§å°±æ¯”è¾ƒå°ï¼Œè€Œæ˜¯ Adelie ä¼é¹…çš„å¯èƒ½æ€§åˆ™æ¯” Chinstrap ä¼é¹…å¤§å¾—å¤šã€‚\n\n### ç‰¹å¾é‡è¦åº¦\n\næ ¹æ®ç‰¹å¾é‡æ’åæ¨¡å‹çš„é¢„æµ‹è¯¯å·®çš„å¢é‡ï¼Œè®¡ç®—ç‰¹å¾çš„é‡è¦åº¦ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmod = Predictor$new(learner, data = dat, y = \"species\")\nimp = FeatureImp$new(mod, loss = \"ce\")\nimp$plot(features = c(\"bill_length\", \"bill_depth\",\n                      \"flipper_length\", \"body_mass\", \"year\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-188-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nå¯è§ï¼Œbill_length å…·æœ‰å¾ˆé«˜çš„ç‰¹å¾é‡è¦åº¦ã€‚\n\næ³¨ï¼šä»¥ä¸Šæ¨¡å‹è§£é‡Šä¹Ÿå¯ä»¥åˆ†åˆ«åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šæ¥åšï¼Œä»¥çœ‹å¯¹æ¯”æ•ˆæœã€‚\n\n## DALEX åŒ…\n\nDALEX åŒ…å¯ä»¥é€è§†ä»»ä½•æ¨¡å‹å¹¶å¸®åŠ©æ¢ç´¢å’Œè§£é‡Šå…¶è¡Œä¸ºï¼Œç”¨å„ç§æ–¹æ³•å¸®åŠ©ç†è§£è¾“å…¥å˜é‡å’Œæ¨¡å‹è¾“å‡ºä¹‹é—´çš„è”ç³»ï¼Œæœ‰åŠ©äºåœ¨å•ä¸ªè§‚æµ‹ä»¥åŠæ•´ä¸ªæ•°æ®ç‰¹å¾çš„å±‚é¢ä¸Šè§£é‡Šæ¨¡å‹ã€‚æ‰€æœ‰çš„æ¨¡å‹è§£é‡Šå™¨éƒ½æ˜¯ä¸æ¨¡å‹æ— å…³çš„ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æ¨¡å‹ä¹‹é—´è¿›è¡Œæ¯”è¾ƒã€‚è¯¥åŒ…æ˜¯ â€œDrWhy.AIâ€ å¯è§†åŒ–æ¨¡å‹è§£é‡Šç³»åˆ—åŒ…çš„åŸºçŸ³ã€‚\n\n![æ¨¡å‹è§£é‡Šæ–¹æ³•åˆ†ç±»](DALEX.jpg){#fig-DALEX}\n\nä»¥ fifa æ•°æ®ï¼Œé¢„æµ‹çƒå‘˜ä»·å€¼ value_eur ä¸ºä¾‹ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(DALEX)\nlibrary(DALEXtra)\nfifa[, c(\"nationality\", \"overall\", \"potential\", \"wage_eur\")] = NULL\nfifa = fifa %>% mutate(across(everything(), .fns = as.numeric))\n```\n:::\n\n\nåˆ›å»ºä»»åŠ¡ï¼Œé€‰æ‹©åŒ…å« 250 æ£µå†³ç­–æ ‘çš„éšæœºæ£®æ—å­¦ä¹ å™¨ï¼Œè®­ç»ƒæ¨¡å‹ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntask = as_task_regr(fifa, target = \"value_eur\")\nranger = lrn(\"regr.ranger\", num.trees = 250)\nranger$train(task)\nranger$model\n#> Ranger result\n#> \n#> Call:\n#>  ranger::ranger(dependent.variable.name = task$target_names, data = task$data(),      case.weights = task$weights$weight, num.threads = 1L, num.trees = 250L) \n#> \n#> Type:                             Regression \n#> Number of trees:                  250 \n#> Sample size:                      5000 \n#> Number of independent variables:  37 \n#> Mtry:                             6 \n#> Target node size:                 5 \n#> Variable importance mode:         none \n#> Splitrule:                        variance \n#> OOB prediction error (MSE):       1.048416e+13 \n#> R squared (OOB):                  0.8666863\n```\n:::\n\n\nåœ¨å¼€å§‹è§£é‡Šæ¨¡å‹è¡Œä¸ºä¹‹å‰ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªè§£é‡Šå™¨ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nranger_exp = explain_mlr3(ranger, data = fifa, y = fifa$value_eur,\n                          label = \"Ranger RF\")\n#> Preparation of a new explainer is initiated\n#>   -> model label       :  Ranger RF \n#>   -> data              :  5000  rows  38  cols \n#>   -> target variable   :  5000  values \n#>   -> predict function  :  yhat.LearnerRegr  will be used (  default  )\n#>   -> predicted values  :  No value for predict function target column. (  default  )\n#>   -> model_info        :  package mlr3 , ver. 0.16.1 , task regression (  default  ) \n#>   -> predicted values  :  numerical, min =  452214 , mean =  7473663 , max =  88491700  \n#>   -> residual function :  difference between y and yhat (  default  )\n#>   -> residuals         :  numerical, min =  -7777793 , mean =  -375.8719 , max =  17675900  \n#>   A new explainer has been created!\n```\n:::\n\n\n### ç‰¹å¾å±‚é¢çš„è§£é‡Š\n\n`model_parts()` å‡½æ•°åŸºäºæ’åˆ—ç»„åˆçš„é‡è¦åº¦æ¥è®¡ç®—å˜é‡çš„é‡è¦åº¦ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfifa_vi = model_parts(ranger_exp)\nhead(fifa_vi)\n#>              variable mean_dropout_loss     label\n#> 1        _full_model_           1334872 Ranger RF\n#> 2           value_eur           1334872 Ranger RF\n#> 3    movement_balance           1397653 Ranger RF\n#> 4           weight_kg           1398740 Ranger RF\n#> 5 goalkeeping_kicking           1405245 Ranger RF\n#> 6           height_cm           1412798 Ranger RF\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(fifa_vi, max_vars = 12, show_boxplots = FALSE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-193-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nä¸€æ—¦çŸ¥é“äº†å“ªäº›å˜é‡æ˜¯æœ€é‡è¦çš„ï¼Œå°±å¯ä»¥ä½¿ç”¨éƒ¨åˆ†ä¾èµ–å›¾æ¥æ˜¾ç¤ºæ¨¡å‹ï¼ˆå¹³å‡è€Œè¨€ï¼‰å¦‚ä½•éšç€é€‰å®šå˜é‡çš„å˜åŒ–è€Œå˜åŒ–ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒä»¬æ˜¾ç¤ºäº†ç‰¹å®šå˜é‡å’Œçƒå‘˜ä»·å€¼ä¹‹é—´çš„å¹³å‡å…³ç³»ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nvars = c(\"age\", \"movement_reactions\", \"skill_ball_control\", \"skill_dribbling\")\nfifa_pd = model_profile(ranger_exp, variables = vars)$agr_profiles\nfifa_pd\n#> Top profiles    : \n#>              _vname_   _label_ _x_  _yhat_ _ids_\n#> 1 skill_ball_control Ranger RF   5 7175057     0\n#> 2    skill_dribbling Ranger RF   7 7750317     0\n#> 3    skill_dribbling Ranger RF  11 7735097     0\n#> 4    skill_dribbling Ranger RF  12 7734165     0\n#> 5    skill_dribbling Ranger RF  13 7732068     0\n#> 6    skill_dribbling Ranger RF  14 7730236     0\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(fifa_pd)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-195-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nå¯è§ï¼Œå¤§å¤šæ•°çƒå‘˜ç‰¹å¾çš„ä¸€èˆ¬è¶‹åŠ¿æ˜¯ç›¸åŒçš„ã€‚æŠ€èƒ½è¶Šé«˜ï¼Œçƒå‘˜çš„ä»·å€¼å°±è¶Šé«˜ï¼Œåªæœ‰ä¸€ä¸ªå˜é‡ä¾‹å¤–â€”â€”å¹´é¾„ã€‚\n\n### è§‚æµ‹å±‚é¢çš„è§£é‡Š\n\næ¢ç´¢æ¨¡å‹åœ¨å•ä¸ªè§‚æµ‹/çƒå‘˜èº«ä¸Šçš„è¡¨ç°ï¼Œä¸‹é¢ä»¥ Cristiano Ronaldo ä¸ºä¾‹ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nronaldo = fifa[\"Cristiano Ronaldo\", ]\nronaldo_bd = predict_parts(ranger_exp, new_observation = ronaldo)\nhead(ronaldo_bd)\n#>                                       contribution\n#> Ranger RF: intercept                       7473663\n#> Ranger RF: movement_reactions = 96        10954295\n#> Ranger RF: skill_ball_control = 92         8641092\n#> Ranger RF: mentality_positioning = 95      5606252\n#> Ranger RF: attacking_finishing = 94        4532342\n#> Ranger RF: skill_dribbling = 89            4401913\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(ronaldo_bd)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-197-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nä¸Šå›¾å±•ç¤ºäº†å„å˜é‡å¯¹æœ€ç»ˆé¢„æµ‹çš„è´¡çŒ®ä¼°è®¡ã€‚Ronaldo æ˜¯ä¸€åå‰é”‹ï¼Œå› æ­¤å½±å“ä»–èº«ä»·çš„ç‰¹å¾æ˜¯é‚£äº›ä¸è¿›æ”»æœ‰å…³çš„ç‰¹å¾ï¼Œå¦‚ attacking_ volleys æˆ– skill_dribblingã€‚å”¯ä¸€å…·æœ‰è´Ÿå‘å½±å“çš„ç‰¹å¾æ˜¯ ageã€‚\n\næ£€æŸ¥æ¨¡å‹çš„å±€éƒ¨è¡Œä¸ºçš„å¦ä¸€ç§æ–¹æ³•æ˜¯ç”¨ SHapley Additive exPlanationsï¼ˆSHAPï¼‰ã€‚å®ƒåœ¨å±€éƒ¨æ˜¾ç¤ºäº†å˜é‡å¯¹å•ä¸€è§‚æµ‹çš„è´¡çŒ®ã€‚\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nronaldo_shap = predict_parts(ranger_exp, new_observation = ronaldo,\n                             type = \"shap\")\nplot(ronaldo_shap)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-198-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\nç‰¹å¾æ•ˆåº”æœ‰éƒ¨åˆ†ä¾èµ–å…³ç³»å›¾ï¼Œå¯¹äºè§‚æµ‹ä¹Ÿæœ‰ç›¸åº”çš„ç‰ˆæœ¬ï¼šCeteris Paribusã€‚å®ƒæ˜¾ç¤ºäº†å½“åªæ”¹å˜ä¸€ä¸ªå˜é‡è€Œå…¶ä»–å˜é‡ä¿æŒä¸å˜æ—¶ï¼Œæ¨¡å‹å¯¹è§‚æµ‹çš„ååº”ï¼ˆè“ç‚¹ä»£è¡¨åŸå§‹å€¼ï¼‰ï¼š\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nronaldo_cp = predict_profile(ranger_exp, ronaldo, variables = vars)\nplot(ronaldo_cp, variables = vars)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-199-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\næ›´å¤šæœºå™¨å­¦ä¹ æ¨¡å‹è§£é‡Šç†è®ºæ–¹æ³•è¯·å‚é˜… Interpretable Machine Learning: A Guide for Making Black\nBox Models Explainable.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}